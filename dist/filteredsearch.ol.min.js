!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=11)}([function(e,t){e.exports='<div>\n    <table id="m-filteredsearch-valuestable">\n        <tbody>\n            {{#each values}}\n                <tr>\n                    <td>{{this}}</td>\n                </tr>\n            {{/each}}\n        </tbody>\n    </table>\n    <div id="m-attributetable-tfoot">\n        <button id="prevBtn">&#8810;</button>\n        <span id="pageNumBtn"></span>\n        <button id="nextBtn">&#8811;</button>\n    </div>\n</div>'},function(e,t){e.exports='<div>\n    <table id="m-filteredsearch-fieldstable">\n        <tbody>\n            {{#each fields}}\n                <tr>\n                    <td>{{this}}</td>\n                </tr>\n            {{/each}}\n        </tbody>\n    </table>\n    <div id="m-attributetable-tfoot">\n        <button id="prevBtn">&#8810;</button>\n        <span id="pageNumBtn"></span>\n        <button id="nextBtn">&#8811;</button>\n    </div>\n</div>'},function(e,t){e.exports='<div id="div-contenedor" class="m-control m-container m-filteredsearch">\n\n    <div class="title">{{translations.title}}</div>\n\n    <div id="m-filteredsearch-options-container"></div>\n\n    <div id="m-filteredsearch-options-buttons">\n        <button id="volver-btn">{{translations.return_btn}}</button>\n        <button id="aceptar-btn">{{translations.accept_btn}}</button>\n        <button id="limpiar-busqueda-btn">{{translations.clear_search}}</button>\n        <button id="limpiar-filtro-btn">{{translations.clear_filter}}</button>\n        <button id="vertabla-btn">{{translations.see_table}}</button>\n        <button id="exportar-btn">{{translations.export}}</button>\n        <button id="guardar-btn">{{translations.save}}</button>\n        <button id="misconsultas-btn">{{translations.my_queries}}</button>\n        <button id="eliminar-btn">{{translations.remove_queries}}</button>\n    </div>\n\n</div>'},function(e,t){e.exports='<div>\n    <table id=\'queryresults\'></table>\n    <div id="paginationbuttons">\n        <button id="prevBtn">&#8810;</button>\n        <span id="pageNumBtn"></span>\n        <button id="nextBtn">&#8811;</button>\n    </div>\n</div>'},function(e,t){e.exports='<div id="m-filteredsearch-initialview">\n    <div id="m-filteredsearch-selects-container">\n        <p class="m-filteredsearch-headers">{{translations.layer}}</p>\n        <select id="m-filteredsearch-layers-select">\n            <option disabled="disabled" id="layers0" selected="selected">{{translations.select_layer}}</option>\n            {{#each layers}}\n                <option name="{{this.name}}">{{this.name}}</option>\n            {{/each}}\n        </select>\n        <p class="m-filteredsearch-headers">{{translations.method}}</p>\n        <select id="m-filteredsearch-method-select">\n            <option disabled="disabled" selected="selected" value="0">{{translations.select_method}}</option>\n            <option value="1">{{translations.new_select}}</option>\n            <option value="2">{{translations.previous_selection}}</option>\n            <option value="3">{{translations.previous_remove}}</option>\n            <option value="4">{{translations.previous_add}}</option>\n        </select>\n    </div>\n\n    <div id="m-filteredsearch-lists-container">\n        <div id="m-filteredsearch-fields">\n            <p class="m-filteredsearch-headers">{{translations.fields}}</p>\n            \x3c!-- Insert here fieldstable.html template. --\x3e\n        </div>\n        <div id="m-filteredsearch-values">\n            <p class="m-filteredsearch-headers">{{translations.values}}</p>\n            \x3c!-- Insert here valuestable.html template. --\x3e\n        </div>\n    </div>\n\n    <div id="m-filteredsearch-operators-container">\n        <p class="m-filteredsearch-headers">{{translations.operators}}</p>\n        \x3c!-- Insert here operator buttons. --\x3e\n    </div>\n\n    <div id="m-filteredsearch-query-container">\n        <p class="m-filteredsearch-headers">{{translations.filter_exp}}</p>\n        <textarea id="m-filteredsearch-textArea" cols="90" rows="5" placeholder="{{translations.placeholder}}"></textarea>\n    </div>\n</div>'},function(e,t){e.exports="<div>\n    {{#if queries}}\n        <table>\n            {{#each queries}}\n                <tr>\n                    <td>{{this.query}}</td>\n                </tr>\n            {{/each}}\n        </table>\n    {{else}}\n        <p>No hay consultas guardadas.</p>\n    {{/if}}\n</div>"},function(e){e.exports=JSON.parse('{"tooltip":"Filtered Search","title":"Filter and search manager","return":"Return","accept":"Accept","clear_search":"Clear search","clear_filter":"Clear filter","see_table":"See table","export":"Export data","save":"Save query","my_queries":"My queries","remove_queries":"Remove query","layer":"Layer","select_layer":"Select a layer","method":"Method","select_method":"Select a method","new_select":"New selection","previous_selection":"Selection on previous","previous_remove":"Remove on previous","previous_add":"Add on previous","fields":"Fields","values":"Values","operators":"Operators","filter_exp":"Filtering expression","placeholder":"The query will appear here.","no_saved_queries":"There are no saved queries.","no_previous_query":"There is no prior consultation.","must_select_method":"You must select a method.","must_select_layer":"You must select a layer.","invalid_query":"Invalid query.","must_query":"You must enter a query.","cant_apply":"You cannot apply a combined query on two different layers.","invalid_filter":"Error: Invalid filter","cant_apply_filter":"The filter could not be applied.","no_export_data":"There is no data to export.","no_entities":"There are no entities with the indicated characteristics.","layer_load":"The layer has not been loaded yet.","hasLayer_error":"The parameter for the hasLayer method is not correct.","error":"Error"}')},function(e){e.exports=JSON.parse('{"tooltip":"Búsqueda por filtros","title":"Gestor de filtros y búsquedas","return":"Volver","accept":"Aceptar","clear_search":"Limpiar búsqueda","clear_filter":"Limpiar filtro","see_table":"Ver tabla","export":"Exportar datos","save":"Guardar consulta","my_queries":"Mis consultas","remove_queries":"Eliminar consulta","layer":"Capa","select_layer":"Seleccione una capa","method":"Método","select_method":"Seleccione método","new_select":"Nueva selección","previous_selection":"Selección sobre anterior","previous_remove":"Eliminar sobre anterior","previous_add":"Añadir sobre anterior","fields":"Campos","values":"Valores","operators":"Operadores","filter_exp":"Expresión de filtrado","placeholder":"La consulta aparecerá aquí.","no_saved_queries":"No hay consultas guardadas.","no_previous_query":"No existe una consulta previa.","must_select_method":"Debe seleccionar un método.","must_select_layer":"Debe seleccionar una capa.","invalid_query":"Consulta inválida.","must_query":"Debe introducir una consulta.","cant_apply":"No se puede aplicar una consulta combinada sobre dos capas diferentes.","invalid_filter":"Error: Filtro inválido","cant_apply_filter":"No se ha podido aplicar el filtro.","no_export_data":"No hay datos para exportar.","no_entities":"No hay entidades con las caracerísticas indicadas.","layer_load":"La capa no se ha cargado todavía.","hasLayer_error":"El parametro para el método hasLayer no es correcto.","error":"Error"}')},function(e){e.exports=JSON.parse('{"url":{"name":"FilteredSearch","separator":"*"},"constructor":"M.plugin.FilteredSearch","parameters":[{"type":"object","properties":[{"type":"enum","name":"position","possibleValues":["TL","TR","BL","BR"],"position":0}]}],"files":{"ol":{"scripts":["filteredsearch.ol.min.js"],"styles":["filteredsearch.ol.min.css"]}},"metadata":{"name":"FilteredSearch","description":"Búsqueda con filtros","text":"Permite realizar búsquedas y aplicar diferentes filtros. Da la posibilidad de poder guardar o exportar la consulta","version":"1.0.0","date":"Junio, 2020","author":"","org":"Consejería de Hacienda, Industria y Energía. Junta de Andalucía.","tags":"mapea,plugin","icon":"./facade/assets/icons/icons.svg","centralized":true}}')},function(e,t,r){},function(e,t,r){},function(e,t,r){"use strict";r.r(t);r(9),r(10);function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e,t,r){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a(this,l(t).apply(this,arguments))}var r,n,u;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(t,M.impl.Control),r=t,(n=[{key:"addTo",value:function(e,r){s(l(t.prototype),"addTo",this).call(this,e,r)}}])&&i(r.prototype,n),u&&i(r,u),t}(),c=r(2),d=r.n(c),p=r(1),h=r.n(p),y=r(0),f=r.n(y),v=r(3),m=r.n(v),b=r(4),g=r.n(b),_=r(5),q=r.n(_),S={en:r(6),es:r(7)},k=function(){var e="es";return"function"==typeof M.language.getLang&&(e=M.language.getLang()),e},L=function(e){return S[e]},w=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:k(),r=L(t),n="";return M.utils.isNullOrEmpty(r)?console.warn("The translation '".concat(t,"' has not been defined.")):n=e.split(".").reduce(function(e,t){return e[t]},r),n};function O(e){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function T(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function E(e,t){var r=Object.keys(e);return Object.getOwnPropertySymbols&&r.push.apply(r,Object.getOwnPropertySymbols(e)),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r}function x(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?E(r,!0).forEach(function(t){P(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function P(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Q(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function A(e,t){return!t||"object"!==O(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function F(e){return(F=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function C(e,t){return(C=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var j=function(e){function t(e){var r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),M.utils.isUndefined(u)&&M.exception("La implementación usada no puede crear controles FilteredSearchControl");var n=new u;return(r=A(this,F(t).call(this,n,"FilteredSearch"))).pluginOnLeft=e.pluginOnLeft,r.sqlQuery="",r.mapeaFilterQuery=null,r.myqueries=[],r.parenthesesClick=0,r.operators=["=","<",">","<=",">=","<>","()","and","or","not","like","%","_"],r.operatorCodes=["&#61;","&lt;","&gt;"],r.fieldsPages=[],r.valuesPages=[],r.fields=[],r.fieldValues=[],r.currentFieldsPage=0,r.currentValuesPage=0,r.resultsPage=0,r.kmlLayers=[],r}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&C(e,t)}(t,M.Control),r=t,(n=[{key:"createView",value:function(e){var t=this;return this.map=e,new Promise(function(r,n){t.createInitialView(e),t.pluginOnLeft&&document.querySelector(".m-panel.filtered-search-panel").querySelector(".m-panel-btn.g-plugin-filteredsearch-filter").addEventListener("click",function(e){var r=document.querySelector(".m-panel.filtered-search-panel.opened");null!==r&&(r=r.querySelector(".m-panel-btn.g-cartografia-flecha-izquierda")),r&&t.pluginOnLeft&&r.classList.add("opened-left")});var i=M.template.compileSync(d.a,{vars:{translations:{title:w("title"),return_btn:w("return"),accept_btn:w("accept"),clear_search:w("clear_search"),clear_filter:w("clear_filter"),see_table:w("see_table"),export:w("export"),save:w("save"),my_queries:w("my_queries"),remove_queries:w("remove_queries")}}});i.querySelector("#m-filteredsearch-options-container").appendChild(t.initialView),t.filterResults=M.template.compileSync(m.a),t.valuesTemplate=M.template.compileSync(f.a,{jsonp:!0,vars:{values:[]}}),t.addEvents(i);var a=i.querySelector("#m-filteredsearch-layers-select");t.subscribeActionLayer(a),t.setInitialButtons(i),t.kmlLayers=t.map.getKML().map(function(e){return{layer:e,loaded:!1}}),r(i)})}},{key:"addEvents",value:function(e){var t=this;this.initialView.querySelector("#m-filteredsearch-layers-select").addEventListener("change",function(e){t.showLayerFields(e.target[e.target.selectedIndex].getAttribute("name"))}),this.initialView.querySelector("#m-filteredsearch-method-select").addEventListener("change",function(e){t.selectionMethod=e.target.value}),e.querySelectorAll("#m-filteredsearch-operators-container>button").forEach(function(e){e.addEventListener("click",function(r){return t.operatorClick(r,e)})}),e.querySelectorAll("#m-filteredsearch-options-buttons>button").forEach(function(e){return e.addEventListener("click",function(e){t.processQuery(e)})}),e.querySelector("#m-filteredsearch-query-container>textarea").addEventListener("input",function(e){t.sqlQuery=e.target.value.replace(/_/g,".").replace(/%/g,".*"),t.setInitialButtons(document.querySelector("#m-filteredsearch-options-buttons"))}),this.map.getKML().forEach(function(e){e.on(M.evt.LOAD,function(){t.kmlLayers.filter(function(t){return t.layer===e})[0].loaded=!0})})}},{key:"createInitialView",value:function(e){var t=this,r={jsonp:!0,vars:{layers:e.getLayers().filter(function(e){return e instanceof M.layer.Vector&&"__draw__"!==e.name}),translations:{layer:w("layer"),select_layer:w("select_layer"),method:w("method"),select_method:w("select_method"),new_select:w("new_select"),previous_selection:w("previous_selection"),previous_remove:w("previous_remove"),previous_add:w("previous_add"),fields:w("fields"),values:w("values"),operators:w("operators"),filter_exp:w("filter_exp"),placeholder:w("placeholder")}}};this.initialView=M.template.compileSync(g.a,r),this.operators.forEach(function(e){var r=document.createTextNode(e),n=document.createElement("button");n.appendChild(r),t.initialView.querySelector("#m-filteredsearch-operators-container").appendChild(n)})}},{key:"turnStringIntoQuery",value:function(e){var t=[],r=this.findNextOperator(e);if(this.isThisTheLastOperator(e,r))return t[0]=e.substring(0,r.indexes[0]).trim(),t[1]=e.substring(r.indexes[1]+1).trim(),this.translateOrderToQuery(r.operator,t);t=this.saveOperands(e,r.indexes);for(var n=0;n<t.length;n+=1)t[n]=this.turnStringIntoQuery(t[n]);return this.translateOrderToQuery(r.operator,t)}},{key:"subscribeActionLayer",value:function(e){var t=this;this.map.on(M.evt.REMOVED_LAYER,function(r){if(Array.isArray(r))r.filter(function(e){return e instanceof M.layer.Vector}).forEach(function(r){return t.removeLayerOption(e,r)});else if(r instanceof M.layer.Vector){var n=x({},r);t.removeLayerOption(e,n)}}),this.map.on(M.evt.ADDED_LAYER,function(r){if(Array.isArray(r))r.filter(function(e){return e instanceof M.layer.Vector}).forEach(function(r){return t.addLayerOption(e,r)});else if(r instanceof M.layer.Vector){var n=x({},r);t.addLayerOption(e,n)}})}},{key:"addLayerOption",value:function(e,t){var r=t.name;if("cluster_cover"!==r&&this.isNotAdded(r,e)){var n=document.createElement("option");n.setAttribute("name",r),n.innerText=r,e.add(n)}}},{key:"removeLayerOption",value:function(e,t){var r=t.name,n=e;"cluster_cover"===r||this.isNotAdded(r,n)||(T(n.children).forEach(function(e){e.innerText===r&&n.removeChild(e)}),n.selectedIndex=0)}},{key:"isNotAdded",value:function(e,t){return!T(t.children).some(function(t){return t.innerHTML===e})}},{key:"findNextOperator",value:function(e){for(var t="",r=[],n=0;n<e.length;n+=1){if("("===e.charAt(n))n=this.findClosingParentheses(e,n)+1;("and"===e.substring(n,n+3)&&!this.operatorInWord(e,[n,n+2])||"or"===e.substring(n,n+2)&&!this.operatorInWord(e,[n,n+1]))&&("and"===e.substring(n,n+3)?(t=e.substring(n,n+3),r[0]=n,r[1]=n+2):(t=e.substring(n,n+2),r[0]=n,r[1]=n+1),n=e.length)}if(""===t)for(var i=0;i<e.length;i+=1){if("("===e.charAt(i))i=this.findClosingParentheses(e,i)+1;("not"===e.substring(i,i+3)&&!this.operatorInWord(e,[i,i+2])||"like"===e.substring(i,i+4)&&!this.operatorInWord(e,[i,i+3]))&&("not"===e.substring(i,i+3)?(t=e.substring(i,i+3),r[0]=i,r[1]=i+2):(t=e.substring(i,i+4),r[0]=i,r[1]=i+3),i=e.length)}if(""===t)for(var a=0;a<e.length;a+=1){if("("===e.charAt(a))a=this.findClosingParentheses(e,a)+1;"<="===e.substring(a,a+2)||">="===e.substring(a,a+2)||"<>"===e.substring(a,a+2)?(t=e.substring(a,a+2),r[0]=a,r[1]=a+1,a=e.length):"="!==e.charAt(a)&&"<"!==e.charAt(a)&&">"!==e.charAt(a)||(t=e.charAt(a),r[0]=a,r[1]=a,a=e.length)}return{operator:t,indexes:r}}},{key:"isThisTheLastOperator",value:function(e,t){var r=this,n=!0,i=["=","<=",">=","<>","(","and","or","not","like"],a="".concat(e.substring(0,t.indexes[0])).concat(e.substring(t.indexes[1]+1));return i.some(function(e){var t=a.indexOf(e)>=0,n=[a.indexOf(e),a.indexOf(e)+i[i.indexOf(e)].length-1],s=!r.operatorInWord(a,n);return t&&s})&&(n=!1),n}},{key:"saveOperands",value:function(e,t){var r=[],n=t[0],i=t[1];return 0!==n&&r.push(e.substring(0,n).trim()),r.push(e.substring(i+1).trim()),r=r.map(function(e){var t=e;return"("===e[0]&&(t=t.substring(1)),")"===e[e.length-1]&&(t=t.substring(0,e.length-1)),t})}},{key:"translateOrderToQuery",value:function(e,t){var r,n,i,a,s,l,o,u="";switch(e){case"=":u=(r=M.filter).EQUAL.apply(r,T(t));break;case"<>":var c=t[0],d=t[1];u=new M.filter.Function(function(e){return e.getAttribute(c)!==d});break;case"<":u=(n=M.filter).LT.apply(n,T(t));break;case">":u=(i=M.filter).GT.apply(i,T(t));break;case"<=":u=(a=M.filter).LTE.apply(a,T(t));break;case">=":u=(s=M.filter).GTE.apply(s,T(t));break;case"and":u=M.filter.AND(T(t));break;case"or":u=M.filter.OR(T(t));break;case"like":u=(l=M.filter).LIKE.apply(l,T(t));break;case"not":u=(o=M.filter).NOT.apply(o,T(t))}return u}},{key:"findClosingParentheses",value:function(e,t){for(var r,n=0,i=t+1;i<e.length;i+=1)0===n&&")"===e.charAt(i)?(r=i,i=e.length):"("===e.charAt(i)?n+=1:")"===e.charAt(i)&&0!==n&&(n-=1);return r}},{key:"operatorInWord",value:function(e,t){var r=!1,n=t[0],i=t[1],a=e[n-1],s=e[i+1];return(void 0!==a&&a.match(/[a-z]/i)||void 0!==s&&s.match(/[a-z]/i))&&(r=!0),r}},{key:"isMapeaFilterParentheses",value:function(e,t){var r=t,n=!1;return(r-11!=-1&&"M.filter."===e.substring(r-11,r-2)&&["OR","LT","GT"].includes(e.substring(r-2,r))||r-12!=-1&&"M.filter."===e.substring(r-12,r-3)&&["AND","NOT","LTE","GTE"].includes(e.substring(r-3,r))||r-13!=-1&&"M.filter."===e.substring(r-13,r-4)&&"LIKE"===e.substring(r-4,r)||r-14!=-1&&"M.filter."===e.substring(r-14,r-5)&&"EQUAL"===e.substring(r-5,r))&&(n=!0),n}},{key:"getMethodFilter",value:function(e){var t;switch(this.selectionMethod){case"1":t=e;break;case"2":void 0!==this.oldFilter?t=M.filter.AND([this.oldFilter,e]):M.dialog.error(w("no_previous_query"));break;case"3":void 0!==this.oldFilter?t=M.filter.AND([this.oldFilter,M.filter.NOT(e)]):M.dialog.error(w("no_previous_query"));break;case"4":void 0!==this.oldFilter?t=M.filter.OR([this.oldFilter,e]):M.dialog.error(w("no_previous_query"));break;default:M.dialog.error(w("must_select_method"))}return t}},{key:"processQuery",value:function(e){var t=document.querySelector("#m-filteredsearch-options-container"),r=document.querySelector("#m-filteredsearch-options-buttons");switch(e.target.getAttribute("id")){case"aceptar-btn":void 0===this.layer_?M.dialog.error(w("must_select_layer")):("1"===this.selectionMethod&&(this.oldFilter=void 0,this.oldLayer=void 0),this.setNewFilter(),this.isValidQuery&&void 0!==this.selectionMethod&&this.setOkButtons());break;case"limpiar-busqueda-btn":this.cleanSearch();break;case"limpiar-filtro-btn":this.layer_.removeFilter(),this.setInitialButtons(r);break;case"vertabla-btn":this.saveResultsOnTable(),t.innerHTML="",t.appendChild(this.filterResults),this.setTableViewButtons(r);break;case"exportar-btn":this.exportResults();break;case"guardar-btn":this.isValidQuery?this.myqueries.push({query:this.sqlQuery,layer:this.layer_}):M.dialog.error(w("invalid_query"));break;case"misconsultas-btn":this.myQueriesClick(t),this.showMyQueriesViewButtons(r);break;case"volver-btn":if(t.innerHTML="",t.appendChild(this.initialView),this.setOkButtons(),void 0!==this.clickedQuery){document.getElementById("m-filteredsearch-textArea").value=this.clickedQuery.query;for(var n=document.getElementById("m-filteredsearch-layers-select"),i=0;i<n.options.length;i++)n.options[i].value===this.clickedQuery.layer.name&&(n.options.selectedIndex=[i]);this.clickedQuery=void 0}document.querySelector("#guardar-btn").style.display="none";break;case"eliminar-btn":break;default:console.log("Este botón no tiene funcionalidad.")}}},{key:"myQueriesClick",value:function(e){var t=e;t.innerHTML="",this.compileMyQueriesTemplate(),this.addSavedQueryClick(),t.appendChild(this.savedQueriesView)}},{key:"addSavedQueryClick",value:function(){var e=this;this.savedQueriesView.querySelectorAll("td").forEach(function(t,r){t.addEventListener("click",function(n){e.savedQueryClicked(n,t,r)})})}},{key:"savedQueryClicked",value:function(e,t,r){var n=this;this.deleteAppliedFilters(),this.clickedQuery=this.myqueries[r],this.mapeaFilterQuery=this.turnStringIntoQuery(this.clickedQuery.query),this.layer_=this.clickedQuery.layer,this.layer_.setFilter(this.mapeaFilterQuery),Array.prototype.forEach.call(e.target.parentNode.parentNode.parentNode.children[0].children,function(e){Array.prototype.forEach.call(e.children,function(e){e.classList.remove("focus")})}),e.target.classList.add("focus");var i=document.querySelector("#m-filteredsearch-options-buttons").querySelector("#eliminar-btn");i.style.display="inline",i.onclick=function(){n.deleteSavedQuery(t,r),n.compileMyQueriesTemplate(),n.addSavedQueryClick(),document.querySelector("#m-filteredsearch-options-container").appendChild(n.savedQueriesView)}}},{key:"deleteSavedQuery",value:function(e,t){this.myqueries.splice(t,1),e.parentNode.remove(),document.querySelector("#m-filteredsearch-options-buttons").querySelector("#eliminar-btn").style.display="none",this.sqlQuery="",this.layer_.removeFilter(),0===this.myqueries.length&&(document.querySelector("#m-filteredsearch-options-container").innerHTML=w("no_saved_queries"))}},{key:"compileMyQueriesTemplate",value:function(){if(void 0!==this.savedQueriesView)for(var e=this.savedQueriesView.lastElementChild;e;)e.remove(),e=this.savedQueriesView.lastElementChild;this.mySqlQueries=this.myqueries.map(function(e){var t=e;return t.query=e.query.replace(/\.\*/g,"%").replace(/\./g,"_"),t}),this.savedQueriesView=M.template.compileSync(q.a,{vars:{queries:this.mySqlQueries,translations:{no_saved_queries:w("no_saved_queries")}}})}},{key:"deleteAppliedFilters",value:function(){this.map.getWFS().concat(this.map.getKML().concat(this.map.getLayers().filter(function(e){return"GeoJSON"===e.type}))).forEach(function(e){null!==e.getFilter&&e.removeFilter()})}},{key:"setNewFilter",value:function(){if(""===this.sqlQuery)M.dialog.error(w("must_query")),this.mapeaFilterQuery=this.oldFilter,this.layer_=this.oldLayer;else if(void 0!==this.oldLayer&&this.oldLayer!==this.layer_)M.dialog.error(w("cant_apply")),this.mapeaFilterQuery=this.oldFilter,this.layer_=this.oldLayer;else{var e;try{if(e=this.turnStringIntoQuery(this.sqlQuery),e=this.getMethodFilter(e),this.layer_.setFilter(e),null===this.layer_.getFilter())throw this.isValidQuery=!1,new Error(w("invalid_filter"));this.mapeaFilterQuery=e,this.oldFilter=this.mapeaFilterQuery,this.oldLayer=this.layer_,this.isValidQuery=!0}catch(e){this.isValidQuery=!1,M.dialog.error(w("cant_apply_filter"))}}}},{key:"exportResults",value:function(){var e=this.layer_.getFeatures();if(e.length>0){var t=this.dataToCsv(e);this.downloadCsv(t)}else M.dialog.error(w("no_export_data"))}},{key:"dataToCsv",value:function(e){var t="",r=Object.keys(e[0].getAttributes());return r.forEach(function(e){t+="".concat(e,",")}),t="".concat(t.substring(0,t.length-1),"\n"),e.forEach(function(e){var n=e.getAttributes();r.forEach(function(e){t+=n[e],t+=","}),t="".concat(t.substring(0,t.length-1),"\n")}),t=t.substring(0,t.length-1)}},{key:"downloadCsv",value:function(e){var t="data:text/csv;charset=utf-8,".concat(encodeURI(e)),r=document.createElement("a");r.href=t,r.download="queryresults.csv",r.click()}},{key:"setInitialButtons",value:function(e){var t=e;t.querySelector("#volver-btn").style.display="none",t.querySelector("#aceptar-btn").style.display="inline",t.querySelector("#limpiar-busqueda-btn").style.display="inline",t.querySelector("#limpiar-filtro-btn").style.display="inline",t.querySelector("#vertabla-btn").style.display="none",t.querySelector("#exportar-btn").style.display="none",t.querySelector("#guardar-btn").style.display="none",t.querySelector("#misconsultas-btn").style.display="inline",t.querySelector("#eliminar-btn").style.display="none"}},{key:"setOkButtons",value:function(){document.querySelector("#volver-btn").style.display="none",document.querySelector("#aceptar-btn").style.display="inline",document.querySelector("#limpiar-busqueda-btn").style.display="inline",document.querySelector("#limpiar-filtro-btn").style.display="inline",document.querySelector("#vertabla-btn").style.display="inline",document.querySelector("#exportar-btn").style.display="inline",document.querySelector("#guardar-btn").style.display="inline",document.querySelector("#misconsultas-btn").style.display="inline",document.querySelector("#eliminar-btn").style.display="none"}},{key:"setTableViewButtons",value:function(e){var t=e;t.querySelector("#volver-btn").style.display="inline",t.querySelector("#aceptar-btn").style.display="none",t.querySelector("#limpiar-busqueda-btn").style.display="none",t.querySelector("#limpiar-filtro-btn").style.display="none",t.querySelector("#vertabla-btn").style.display="none",t.querySelector("#exportar-btn").style.display="none",t.querySelector("#guardar-btn").style.display="none",t.querySelector("#misconsultas-btn").style.display="none"}},{key:"showMyQueriesViewButtons",value:function(e){var t=e;t.querySelector("#volver-btn").style.display="inline",t.querySelector("#aceptar-btn").style.display="none",t.querySelector("#limpiar-busqueda-btn").style.display="none",t.querySelector("#limpiar-filtro-btn").style.display="none",t.querySelector("#vertabla-btn").style.display="none",t.querySelector("#exportar-btn").style.display="none",t.querySelector("#guardar-btn").style.display="none",t.querySelector("#misconsultas-btn").style.display="none"}},{key:"cleanSearch",value:function(){document.querySelector(".filtered-search-panel").querySelector("textarea").value="",document.querySelector("#m-filteredsearch-method-select").value=w("select_method"),this.selectionMethod="",this.sqlQuery="",document.querySelector("#m-filteredsearch-layers-select").querySelector("#layers0").selected=!0,document.querySelector("#m-filteredsearch-fields").innerHTML='<p class="m-filteredsearch-headers">'.concat(w("fields"),"</p>"),document.querySelector("#m-filteredsearch-values").innerHTML='<p class="m-filteredsearch-headers">'.concat(w("values"),"</p>")}},{key:"showTableViewPage",value:function(e){var t=this;this.filterResults.querySelector("#queryresults").innerHTML="";var r=this.layer_.getFeatures()[0].getAttributes(),n=document.createElement("tr");Object.keys(r).forEach(function(e){var t=document.createElement("th"),r=document.createTextNode(e);t.appendChild(r),n.appendChild(t)}),this.filterResults.querySelector("#queryresults").appendChild(n),this.filterResults.querySelector("#paginationbuttons>#pageNumBtn").innerHTML="".concat(this.resultsPage+1," de ").concat(e.length),e[this.resultsPage].forEach(function(e){n=document.createElement("tr");var r=e.getAttributes();Object.keys(r).forEach(function(e){var t=document.createElement("td"),i=document.createTextNode(r[e].toString());t.appendChild(i),n.appendChild(t)}),t.filterResults.querySelector("#queryresults").appendChild(n)})}},{key:"saveResultsOnTable",value:function(){var e=this;if(this.layer_.getFeatures().length>0){var t=this.divideList(this.layer_.getFeatures());this.showTableViewPage(t),this.filterResults.querySelectorAll("#paginationbuttons>button").forEach(function(r){r.addEventListener("click",function(r){"prevBtn"===r.target.id?e.resultsPage=e.resultsPage>0?e.resultsPage-=1:e.resultsPage:e.resultsPage=e.resultsPage<t.length-1?e.resultsPage+=1:e.resultsPage,e.showTableViewPage(t)})})}else this.filterResults.innerHTML=w("no_entities")}},{key:"operatorClick",value:function(e,t){var r=document.querySelector(".filtered-search-panel").querySelector("textarea");switch(t.innerHTML){case"()":0===this.parenthesesClick?(r.value+="(",this.sqlQuery+="(",this.parenthesesClick=1):(r.value+=")",this.sqlQuery+=")",this.parenthesesClick=0);break;case"&#61;":r.value+=" = ",this.sqlQuery+=" = ";break;case"&lt;":r.value+=" < ",this.sqlQuery+=" < ";break;case"&gt;":r.value+=" > ",this.sqlQuery+=" > ";break;case"&lt;&gt;":r.value+=" <> ",this.sqlQuery+=" <> ";break;case"&gt;=":r.value+=" >= ",this.sqlQuery+=" >= ";break;case"&lt;=":r.value+=" <= ",this.sqlQuery+=" <= ";break;case"_":r.value+="_",this.sqlQuery+=".";break;case"%":r.value+="%",this.sqlQuery+=".*";break;default:r.value+=" ".concat(t.innerHTML.toLowerCase()," "),this.sqlQuery+=" ".concat(t.innerHTML.toLowerCase()," ")}}},{key:"showLayerFields",value:function(e){var t=this;if(M.utils.isNullOrEmpty(e)||(this.layer_=this.hasLayer_(e)[0]),this.isLayerLoaded(this.layer_)){this.fieldValues=[];var r=this.layer_.getFeatures();if(this.oldFilter=this.mapeaFilterQuery,this.oldLayer=this.layer_,document.querySelector(".filtered-search-panel").querySelector("textarea").value="",this.sqlQuery="",this.mapeaFilterQuery=null,!M.utils.isNullOrEmpty(r)){this.fields=Object.keys(r[0].getAttributes()),r.forEach(function(e){var r=Object.values(e.getAttributes());M.utils.isNullOrEmpty(r)||t.fieldValues.push(r)}),this.fieldsPages=this.divideList(this.fields);var n={jsonp:!0,vars:{fields:this.fieldsPages[0]}};this.fieldsTemplate=M.template.compileSync(h.a,n),this.fieldsTemplate.querySelector("#pageNumBtn").innerHTML="1 de ".concat(this.fieldsPages.length),document.querySelector("#m-filteredsearch-fields").innerHTML='<p class="m-filteredsearch-headers">'.concat(w("fields"),"</p>"),document.querySelector("#m-filteredsearch-fields").appendChild(this.fieldsTemplate),this.showFields(),this.addpageBtnEvt()}}else M.dialog.error(w("layer_load"))}},{key:"isLayerLoaded",value:function(e){var t=!1,r=!!this.kmlLayers.find(function(t){return t.layer===e})&&this.kmlLayers.find(function(t){return t.layer===e}).loaded;return e.type&&"KML"!==e.type&&e.getImpl().isLoaded()?t=!0:r&&(t=!0),t}},{key:"showFields",value:function(){var e=this;document.querySelector("#m-filteredsearch-fields").querySelectorAll("td").forEach(function(t){var r=[],n=e.fields.indexOf(t.innerHTML);e.fieldValues.forEach(function(e){r.push(e[n])}),t.addEventListener("click",function(t){document.querySelector(".filtered-search-panel").querySelector("textarea").value+=t.target.innerHTML,e.sqlQuery+=t.target.innerHTML,e.selectField(r),Array.prototype.forEach.call(t.target.parentNode.parentNode.parentNode.children[0].children,function(e){Array.prototype.forEach.call(e.children,function(e){e.classList.remove("focus")})}),t.target.classList.add("focus")})})}},{key:"addpageBtnEvt",value:function(){var e=this;this.fieldsTemplate.querySelectorAll("#m-attributetable-tfoot>button").forEach(function(t){t.addEventListener("click",function(t){return e.changePage(t,"fields",e.fieldsPages.length)})}),this.valuesTemplate.querySelectorAll("#m-attributetable-tfoot>button").forEach(function(t){t.addEventListener("click",function(t){return e.changePage(t,"values",e.valuesPages.length)})})}},{key:"divideList",value:function(e){for(var t=[],r=0;r<e.length;){for(var n=[],i=r;i<r+5;i+=1)n.push(e[i]),i+1===e.length&&(i=r+5);t.push(n),r+=5}return t}},{key:"changePage",value:function(e,t,r){var n="fields"===t?this.currentFieldsPage:this.currentValuesPage;n="prevBtn"===e.target.id?n>0?n-=1:n:n<r-1?n+=1:n,"fields"===t?this.currentFieldsPage=n:this.currentValuesPage=n,this.showPageResults(t),this.addpageBtnEvt()}},{key:"showPageResults",value:function(e){var t=this;if("fields"===e){var r={jsonp:!0,vars:{fields:this.fieldsPages[this.currentFieldsPage]}};this.fieldsTemplate=M.template.compileSync(h.a,r),this.fieldsTemplate.querySelector("#pageNumBtn").innerHTML="".concat(this.currentFieldsPage+1," de ").concat(this.fieldsPages.length),document.querySelector("#m-filteredsearch-fields").innerHTML='<p class="m-filteredsearch-headers">'.concat(w("fields"),"</p>"),document.querySelector("#m-filteredsearch-fields").appendChild(this.fieldsTemplate),this.showFields()}else{var n={jsonp:!0,vars:{values:this.valuesPages[this.currentValuesPage]}};this.valuesTemplate=M.template.compileSync(f.a,n),this.valuesTemplate.querySelector("#pageNumBtn").innerHTML="".concat(this.currentValuesPage+1," de ").concat(this.valuesPages.length),this.fieldsTemplate.querySelector("#pageNumBtn").innerHTML="".concat(this.currentFieldsPage+1," de ").concat(this.fieldsPages.length),document.querySelector("#m-filteredsearch-values").innerHTML='<p class="m-filteredsearch-headers">'.concat(w("values"),"</p>"),document.querySelector("#m-filteredsearch-values").appendChild(this.valuesTemplate),document.querySelector("#m-filteredsearch-values").querySelectorAll("td").forEach(function(e){e.addEventListener("click",function(e){document.querySelector(".filtered-search-panel").querySelector("textarea").value+=e.target.innerHTML,t.sqlQuery+=e.target.innerHTML,Array.prototype.forEach.call(e.target.parentNode.parentNode.parentNode.children[0].children,function(e){Array.prototype.forEach.call(e.children,function(e){e.classList.remove("focus")})}),e.target.classList.add("focus")})})}}},{key:"selectField",value:function(e){var t=this,r=e.filter(function(e,t,r){return r.indexOf(e)===t});this.valuesPages=this.divideList(r);var n={jsonp:!0,vars:{values:this.valuesPages[0]}};this.currentFieldsPage=0,this.currentValuesPage=0,this.valuesTemplate=M.template.compileSync(f.a,n),this.valuesTemplate.querySelector("#pageNumBtn").innerHTML="".concat(this.currentValuesPage+1," de ").concat(this.valuesPages.length),this.valuesTemplate.querySelectorAll("#m-filteredsearch-valuestable>tbody>tr>td").forEach(function(e){e.addEventListener("click",function(e){return t.selectValue(e)})}),document.querySelector("#m-filteredsearch-values").innerHTML="<p class='m-filteredsearch-headers'>".concat(w("values"),"</p>"),document.querySelector("#m-filteredsearch-values").appendChild(this.valuesTemplate),this.addpageBtnEvt()}},{key:"selectValue",value:function(e){document.querySelector(".filtered-search-panel").querySelector("textarea").value+=e.currentTarget.innerHTML,this.sqlQuery+=e.currentTarget.innerHTML,Array.prototype.forEach.call(e.currentTarget.parentNode.parentNode.children,function(e){e.children[0].classList.remove("focus")}),e.currentTarget.classList.add("focus")}},{key:"hasLayer_",value:function(e){var t=[];return!M.utils.isNullOrEmpty(e)&&(M.utils.isArray(e)||M.utils.isString(e)||e instanceof M.Layer)?(M.utils.isString(e)&&this.map.getLayers().forEach(function(r){r.name===e&&t.push(r)}),e instanceof M.Layer&&this.map.getLayers().forEach(function(r){r.equals(e)&&t.push(r)}),M.utils.isArray(e)&&this.map.getLayers().forEach(function(r){e.indexOf(r.name)>=0&&t.push(r)}),t):(M.dialog.error(w("hasLayer_error"),w("error")),t)}},{key:"equals",value:function(e){return e instanceof t}}])&&Q(r.prototype,n),i&&Q(r,i),t}(),N=r(8);function V(e){return(V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function B(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function R(e,t){return!t||"object"!==V(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function I(e){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function H(e,t){return(H=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var D=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=R(this,I(t).call(this))).map_=null,r.controls_=[],r.position_=e.position||"TR",r.metadata_=N.metadata,r}var r,n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&H(e,t)}(t,M.Plugin),r=t,(n=[{key:"addTo",value:function(e){var t={pluginOnLeft:!!["TL","BL"].includes(this.position_)};this.control_=new j(t),this.controls_.push(this.control_),this.map_=e;this.panel_=new M.ui.Panel("panelFilteredSearch",{className:"filtered-search-panel",collapsible:!0,position:M.ui.position[this.position_],collapsedButtonClass:"g-plugin-filteredsearch-filter",tooltip:w("tooltip")}),this.panel_.addControls(this.controls_),e.addPanels(this.panel_)}},{key:"destroy",value:function(){this.map_.removeControls(this.controls_);var e=[null,null,null,null];this.map_=e[0],this.control_=e[1],this.controls_=e[2],this.panel_=e[3]}},{key:"getMetadata",value:function(){return this.metadata_}},{key:"name",get:function(){return"filteredsearch"}}])&&B(r.prototype,n),i&&B(r,i),t}();window.M.plugin||(window.M.plugin={}),window.M.control||(window.M.control={}),window.M.impl||(window.M.impl={}),window.M.impl.control||(window.M.impl.control={}),window.M.plugin.FilteredSearch=D,window.M.control.FilteredSearchControl=j,window.M.impl.control.FilteredSearchControl=u}]);
//# sourceMappingURL=filteredsearch.ol.min.js.map