!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=11)}([function(e,t){e.exports='<div>\n    <table id="m-filteredsearch-valuestable">\n        <tbody>\n            {{#each values}}\n                <tr>\n                    <td>{{this}}</td>\n                </tr>\n            {{/each}}\n        </tbody>\n    </table>\n    <div id="m-attributetable-tfoot">\n        <button id="prevBtn">&#8810;</button>\n        <span id="pageNumBtn"></span>\n        <button id="nextBtn">&#8811;</button>\n    </div>\n</div>'},function(e,t){e.exports='<div>\n    <table id="m-filteredsearch-fieldstable">\n        <tbody>\n            {{#each fields}}\n                <tr>\n                    <td>{{this}}</td>\n                </tr>\n            {{/each}}\n        </tbody>\n    </table>\n    <div id="m-attributetable-tfoot">\n        <button id="prevBtn">&#8810;</button>\n        <span id="pageNumBtn"></span>\n        <button id="nextBtn">&#8811;</button>\n    </div>\n</div>'},function(e,t){e.exports='<div id="div-contenedor" class="m-control m-container m-filteredsearch">\n\n    <div class="title">{{translations.title}}</div>\n\n    <div id="m-filteredsearch-options-container"></div>\n\n    <div id="m-filteredsearch-options-buttons">\n        <button id="volver-btn">{{translations.return_btn}}</button>\n        <button id="aceptar-btn">{{translations.accept_btn}}</button>\n        <button id="limpiar-busqueda-btn">{{translations.clear_search}}</button>\n        <button id="limpiar-filtro-btn">{{translations.clear_filter}}</button>\n        <button id="vertabla-btn">{{translations.see_table}}</button>\n        <button id="exportar-btn">{{translations.export}}</button>\n        <button id="guardar-btn">{{translations.save}}</button>\n        <button id="misconsultas-btn">{{translations.my_queries}}</button>\n        <button id="eliminar-btn">{{translations.remove_queries}}</button>\n    </div>\n\n</div>'},function(e,t){e.exports='<div>\n    <table id=\'queryresults\'></table>\n    <div id="paginationbuttons">\n        <button id="prevBtn">&#8810;</button>\n        <span id="pageNumBtn"></span>\n        <button id="nextBtn">&#8811;</button>\n    </div>\n</div>'},function(e,t){e.exports='<div id="m-filteredsearch-initialview">\n    <div id="m-filteredsearch-selects-container">\n        <p class="m-filteredsearch-headers">{{translations.layer}}</p>\n        <select id="m-filteredsearch-layers-select">\n            <option disabled="disabled" id="layers0" selected="selected">{{translations.select_layer}}</option>\n            {{#each layers}}\n                <option name="{{this.name}}">{{this.name}}</option>\n            {{/each}}\n        </select>\n        <p class="m-filteredsearch-headers">{{translations.method}}</p>\n        <select id="m-filteredsearch-method-select">\n            <option disabled="disabled" selected="selected" value="0">{{translations.select_method}}</option>\n            <option value="1">{{translations.new_select}}</option>\n            <option value="2">{{translations.previous_selection}}</option>\n            <option value="3">{{translations.previous_remove}}</option>\n            <option value="4">{{translations.previous_add}}</option>\n        </select>\n    </div>\n\n    <div id="m-filteredsearch-lists-container">\n        <div id="m-filteredsearch-fields">\n            <p class="m-filteredsearch-headers">{{translations.fields}}</p>\n            \x3c!-- Insert here fieldstable.html template. --\x3e\n        </div>\n        <div id="m-filteredsearch-values">\n            <p class="m-filteredsearch-headers">{{translations.values}}</p>\n            \x3c!-- Insert here valuestable.html template. --\x3e\n        </div>\n    </div>\n\n    <div id="m-filteredsearch-operators-container">\n        <p class="m-filteredsearch-headers">{{translations.operators}}</p>\n        \x3c!-- Insert here operator buttons. --\x3e\n    </div>\n\n    <div id="m-filteredsearch-query-container">\n        <p class="m-filteredsearch-headers">{{translations.filter_exp}}</p>\n        <textarea id="m-filteredsearch-textArea" cols="90" rows="5" placeholder="{{translations.placeholder}}"></textarea>\n    </div>\n</div>'},function(e,t){e.exports="<div>\n    {{#if queries}}\n        <table>\n            {{#each queries}}\n                <tr>\n                    <td>{{this.query}}</td>\n                </tr>\n            {{/each}}\n        </table>\n    {{else}}\n        <p>{{translations.no_saved_queries}}</p>\n    {{/if}}\n</div>"},function(e){e.exports=JSON.parse('{"tooltip":"Filtered Search","title":"Filter and search manager","return":"Return","accept":"Accept","clear_search":"Clear search","clear_filter":"Clear filter","see_table":"See table","export":"Export data","save":"Save query","my_queries":"My queries","remove_queries":"Remove query","layer":"Layer","select_layer":"Select a layer","method":"Method","select_method":"Select a method","new_select":"New selection","previous_selection":"Selection on previous","previous_remove":"Remove on previous","previous_add":"Add on previous","fields":"Fields","values":"Values","operators":"Operators","filter_exp":"Filtering expression","placeholder":"The query will appear here.","no_saved_queries":"There are no saved queries.","no_previous_query":"There is no prior consultation.","must_select_method":"You must select a method.","must_select_layer":"You must select a layer.","invalid_query":"Invalid query.","must_query":"You must enter a query.","cant_apply":"You cannot apply a combined query on two different layers.","invalid_filter":"Error: Invalid filter","cant_apply_filter":"The filter could not be applied.","no_export_data":"There is no data to export.","no_entities":"There are no entities with the indicated characteristics.","layer_load":"The layer has not been loaded yet.","hasLayer_error":"The parameter for the hasLayer method is not correct.","error":"Error"}')},function(e){e.exports=JSON.parse('{"tooltip":"Búsqueda por filtros","title":"Gestor de filtros y búsquedas","return":"Volver","accept":"Aceptar","clear_search":"Limpiar búsqueda","clear_filter":"Limpiar filtro","see_table":"Ver tabla","export":"Exportar datos","save":"Guardar consulta","my_queries":"Mis consultas","remove_queries":"Eliminar consulta","layer":"Capa","select_layer":"Seleccione una capa","method":"Método","select_method":"Seleccione método","new_select":"Nueva selección","previous_selection":"Selección sobre anterior","previous_remove":"Eliminar sobre anterior","previous_add":"Añadir sobre anterior","fields":"Campos","values":"Valores","operators":"Operadores","filter_exp":"Expresión de filtrado","placeholder":"La consulta aparecerá aquí.","no_saved_queries":"No hay consultas guardadas.","no_previous_query":"No existe una consulta previa.","must_select_method":"Debe seleccionar un método.","must_select_layer":"Debe seleccionar una capa.","invalid_query":"Consulta inválida.","must_query":"Debe introducir una consulta.","cant_apply":"No se puede aplicar una consulta combinada sobre dos capas diferentes.","invalid_filter":"Error: Filtro inválido","cant_apply_filter":"No se ha podido aplicar el filtro.","no_export_data":"No hay datos para exportar.","no_entities":"No hay entidades con las caracerísticas indicadas.","layer_load":"La capa no se ha cargado todavía.","hasLayer_error":"El parametro para el método hasLayer no es correcto.","error":"Error"}')},function(e){e.exports=JSON.parse('{"url":{"name":"FilteredSearch","separator":"*"},"constructor":"M.plugin.FilteredSearch","parameters":[{"type":"object","properties":[{"type":"enum","name":"position","possibleValues":["TL","TR","BL","BR"],"position":0}]}],"files":{"ol":{"scripts":["filteredsearch.ol.min.js"],"styles":["filteredsearch.ol.min.css"]}},"metadata":{"name":"FilteredSearch","description":"Búsqueda con filtros","text":"Permite realizar búsquedas y aplicar diferentes filtros. Da la posibilidad de poder guardar o exportar la consulta","version":"1.0.1","date":"Abril, 2021","author":"","org":"Consejería de Hacienda, Industria y Energía. Junta de Andalucía.","tags":"mapea,plugin","icon":"./facade/assets/icons/icons.svg","centralized":true,"compatibility":["5","6"]}}')},function(e,t,r){},function(e,t,r){},function(e,t,r){"use strict";r.r(t);r(9),r(10);function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,r){return(o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=c(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=c(e);if(t){var i=c(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return u(this,r)}}function u(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var d=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(d,M.impl.Control);var t,r,n,u=l(d);function d(){return i(this,d),u.apply(this,arguments)}return t=d,(r=[{key:"addTo",value:function(e,t){o(c(d.prototype),"addTo",this).call(this,e,t)}}])&&a(t.prototype,r),n&&a(t,n),d}(),p=r(2),f=r.n(p),y=r(1),h=r.n(y),v=r(0),m=r.n(v),b=r(3),g=r.n(b),_=r(4),q=r.n(_),S=r(5),k=r.n(S),L={en:r(6),es:r(7)},w=function(){var e="es";return"function"==typeof M.language.getLang&&(e=M.language.getLang()),e},O=function(e){return L[e]},T=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w(),r=O(t),n="";return M.utils.isNullOrEmpty(r)?console.warn("The translation '".concat(t,"' has not been defined.")):n=e.split(".").reduce((function(e,t){return e[t]}),r),n};function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function x(e){return function(e){if(Array.isArray(e))return P(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return P(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return P(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function P(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function A(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(r),!0).forEach((function(t){F(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function F(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function C(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function j(e,t){return(j=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function N(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=R(e);if(t){var i=R(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return V(this,r)}}function V(e,t){return!t||"object"!==E(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function R(e){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var B=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&j(e,t)}(a,M.Control);var t,r,n,i=N(a);function a(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),M.utils.isUndefined(d)&&M.exception("La implementación usada no puede crear controles FilteredSearchControl");var r=new d;return(t=i.call(this,r,"FilteredSearch")).pluginOnLeft=e.pluginOnLeft,t.sqlQuery="",t.mapeaFilterQuery=null,t.myqueries=[],t.parenthesesClick=0,t.operators=["=","<",">","<=",">=","<>","()","and","or","not","like","%","_"],t.operatorCodes=["&#61;","&lt;","&gt;"],t.fieldsPages=[],t.valuesPages=[],t.fields=[],t.fieldValues=[],t.currentFieldsPage=0,t.currentValuesPage=0,t.resultsPage=0,t.kmlLayers=[],t}return t=a,(r=[{key:"createView",value:function(e){var t=this;return this.map=e,new Promise((function(r,n){t.createInitialView(e),t.pluginOnLeft&&document.querySelector(".m-panel.filtered-search-panel").querySelector(".m-panel-btn.g-plugin-filteredsearch-filter").addEventListener("click",(function(e){var r=document.querySelector(".m-panel.filtered-search-panel.opened");null!==r&&(r=r.querySelector(".m-panel-btn.g-cartografia-flecha-izquierda")),r&&t.pluginOnLeft&&r.classList.add("opened-left")}));var i=M.template.compileSync(f.a,{vars:{translations:{title:T("title"),return_btn:T("return"),accept_btn:T("accept"),clear_search:T("clear_search"),clear_filter:T("clear_filter"),see_table:T("see_table"),export:T("export"),save:T("save"),my_queries:T("my_queries"),remove_queries:T("remove_queries")}}});i.querySelector("#m-filteredsearch-options-container").appendChild(t.initialView),t.filterResults=M.template.compileSync(g.a),t.valuesTemplate=M.template.compileSync(m.a,{jsonp:!0,vars:{values:[]}}),t.addEvents(i);var a=i.querySelector("#m-filteredsearch-layers-select");t.subscribeActionLayer(a),t.setInitialButtons(i),t.kmlLayers=t.map.getKML().map((function(e){return{layer:e,loaded:!1}})),r(i)}))}},{key:"addEvents",value:function(e){var t=this;this.initialView.querySelector("#m-filteredsearch-layers-select").addEventListener("change",(function(e){t.showLayerFields(e.target[e.target.selectedIndex].getAttribute("name"))})),this.initialView.querySelector("#m-filteredsearch-method-select").addEventListener("change",(function(e){t.selectionMethod=e.target.value})),e.querySelectorAll("#m-filteredsearch-operators-container>button").forEach((function(e){e.addEventListener("click",(function(r){return t.operatorClick(r,e)}))})),e.querySelectorAll("#m-filteredsearch-options-buttons>button").forEach((function(e){return e.addEventListener("click",(function(e){t.processQuery(e)}))})),e.querySelector("#m-filteredsearch-query-container>textarea").addEventListener("input",(function(e){t.sqlQuery=e.target.value.replace(/_/g,".").replace(/%/g,".*"),t.setInitialButtons(document.querySelector("#m-filteredsearch-options-buttons"))})),this.map.getKML().forEach((function(e){e.on(M.evt.LOAD,(function(){t.kmlLayers.filter((function(t){return t.layer===e}))[0].loaded=!0}))}))}},{key:"createInitialView",value:function(e){var t=this,r={jsonp:!0,vars:{layers:e.getLayers().filter((function(e){return e instanceof M.layer.Vector&&"__draw__"!==e.name})),translations:{layer:T("layer"),select_layer:T("select_layer"),method:T("method"),select_method:T("select_method"),new_select:T("new_select"),previous_selection:T("previous_selection"),previous_remove:T("previous_remove"),previous_add:T("previous_add"),fields:T("fields"),values:T("values"),operators:T("operators"),filter_exp:T("filter_exp"),placeholder:T("placeholder")}}};this.initialView=M.template.compileSync(q.a,r),this.operators.forEach((function(e){var r=document.createTextNode(e),n=document.createElement("button");n.appendChild(r),t.initialView.querySelector("#m-filteredsearch-operators-container").appendChild(n)}))}},{key:"turnStringIntoQuery",value:function(e){var t=[],r=this.findNextOperator(e);if(this.isThisTheLastOperator(e,r))return t[0]=e.substring(0,r.indexes[0]).trim(),t[1]=e.substring(r.indexes[1]+1).trim(),this.translateOrderToQuery(r.operator,t);t=this.saveOperands(e,r.indexes);for(var n=0;n<t.length;n+=1)t[n]=this.turnStringIntoQuery(t[n]);return this.translateOrderToQuery(r.operator,t)}},{key:"subscribeActionLayer",value:function(e){var t=this;this.map.on(M.evt.REMOVED_LAYER,(function(r){if(Array.isArray(r))r.filter((function(e){return e instanceof M.layer.Vector})).forEach((function(r){return t.removeLayerOption(e,r)}));else if(r instanceof M.layer.Vector){var n=A({},r);t.removeLayerOption(e,n)}})),this.map.on(M.evt.ADDED_LAYER,(function(r){if(Array.isArray(r))r.filter((function(e){return e instanceof M.layer.Vector})).forEach((function(r){return t.addLayerOption(e,r)}));else if(r instanceof M.layer.Vector){var n=A({},r);t.addLayerOption(e,n)}}))}},{key:"addLayerOption",value:function(e,t){var r=t.name;if("cluster_cover"!==r&&this.isNotAdded(r,e)){var n=document.createElement("option");n.setAttribute("name",r),n.innerText=r,e.add(n)}}},{key:"removeLayerOption",value:function(e,t){var r=t.name,n=e;"cluster_cover"===r||this.isNotAdded(r,n)||(x(n.children).forEach((function(e){e.innerText===r&&n.removeChild(e)})),n.selectedIndex=0)}},{key:"isNotAdded",value:function(e,t){return!x(t.children).some((function(t){return t.innerHTML===e}))}},{key:"findNextOperator",value:function(e){for(var t="",r=[],n=0;n<e.length;n+=1)"("===e.charAt(n)&&(n=this.findClosingParentheses(e,n)+1),("and"===e.substring(n,n+3)&&!this.operatorInWord(e,[n,n+2])||"or"===e.substring(n,n+2)&&!this.operatorInWord(e,[n,n+1]))&&("and"===e.substring(n,n+3)?(t=e.substring(n,n+3),r[0]=n,r[1]=n+2):(t=e.substring(n,n+2),r[0]=n,r[1]=n+1),n=e.length);if(""===t)for(var i=0;i<e.length;i+=1)"("===e.charAt(i)&&(i=this.findClosingParentheses(e,i)+1),("not"===e.substring(i,i+3)&&!this.operatorInWord(e,[i,i+2])||"like"===e.substring(i,i+4)&&!this.operatorInWord(e,[i,i+3]))&&("not"===e.substring(i,i+3)?(t=e.substring(i,i+3),r[0]=i,r[1]=i+2):(t=e.substring(i,i+4),r[0]=i,r[1]=i+3),i=e.length);if(""===t)for(var a=0;a<e.length;a+=1)"("===e.charAt(a)&&(a=this.findClosingParentheses(e,a)+1),"<="===e.substring(a,a+2)||">="===e.substring(a,a+2)||"<>"===e.substring(a,a+2)?(t=e.substring(a,a+2),r[0]=a,r[1]=a+1,a=e.length):"="!==e.charAt(a)&&"<"!==e.charAt(a)&&">"!==e.charAt(a)||(t=e.charAt(a),r[0]=a,r[1]=a,a=e.length);return{operator:t,indexes:r}}},{key:"isThisTheLastOperator",value:function(e,t){var r=this,n=!0,i=["=","<=",">=","<>","(","and","or","not","like"],a="".concat(e.substring(0,t.indexes[0])).concat(e.substring(t.indexes[1]+1));return i.some((function(e){var t=a.indexOf(e)>=0,n=[a.indexOf(e),a.indexOf(e)+i[i.indexOf(e)].length-1],o=!r.operatorInWord(a,n);return t&&o}))&&(n=!1),n}},{key:"saveOperands",value:function(e,t){var r=[],n=t[0],i=t[1];return 0!==n&&r.push(e.substring(0,n).trim()),r.push(e.substring(i+1).trim()),r=r.map((function(e){var t=e;return"("===e[0]&&(t=t.substring(1)),")"===e[e.length-1]&&(t=t.substring(0,e.length-1)),t}))}},{key:"translateOrderToQuery",value:function(e,t){var r,n,i,a,o,s,l,u="";switch(e){case"=":u=(r=M.filter).EQUAL.apply(r,x(t));break;case"<>":var c=t[0],d=t[1];u=new M.filter.Function((function(e){return e.getAttribute(c)!==d}));break;case"<":u=(n=M.filter).LT.apply(n,x(t));break;case">":u=(i=M.filter).GT.apply(i,x(t));break;case"<=":u=(a=M.filter).LTE.apply(a,x(t));break;case">=":u=(o=M.filter).GTE.apply(o,x(t));break;case"and":u=M.filter.AND(x(t));break;case"or":u=M.filter.OR(x(t));break;case"like":u=(s=M.filter).LIKE.apply(s,x(t));break;case"not":u=(l=M.filter).NOT.apply(l,x(t))}return u}},{key:"findClosingParentheses",value:function(e,t){for(var r,n=0,i=t+1;i<e.length;i+=1)0===n&&")"===e.charAt(i)?(r=i,i=e.length):"("===e.charAt(i)?n+=1:")"===e.charAt(i)&&0!==n&&(n-=1);return r}},{key:"operatorInWord",value:function(e,t){var r=!1,n=t[0],i=t[1],a=e[n-1],o=e[i+1];return(void 0!==a&&a.match(/[a-z]/i)||void 0!==o&&o.match(/[a-z]/i))&&(r=!0),r}},{key:"isMapeaFilterParentheses",value:function(e,t){var r=t,n=!1;return(r-11!=-1&&"M.filter."===e.substring(r-11,r-2)&&["OR","LT","GT"].includes(e.substring(r-2,r))||r-12!=-1&&"M.filter."===e.substring(r-12,r-3)&&["AND","NOT","LTE","GTE"].includes(e.substring(r-3,r))||r-13!=-1&&"M.filter."===e.substring(r-13,r-4)&&"LIKE"===e.substring(r-4,r)||r-14!=-1&&"M.filter."===e.substring(r-14,r-5)&&"EQUAL"===e.substring(r-5,r))&&(n=!0),n}},{key:"getMethodFilter",value:function(e){var t;switch(this.selectionMethod){case"1":t=e;break;case"2":void 0!==this.oldFilter?t=M.filter.AND([this.oldFilter,e]):M.dialog.error(T("no_previous_query"));break;case"3":void 0!==this.oldFilter?t=M.filter.AND([this.oldFilter,M.filter.NOT(e)]):M.dialog.error(T("no_previous_query"));break;case"4":void 0!==this.oldFilter?t=M.filter.OR([this.oldFilter,e]):M.dialog.error(T("no_previous_query"));break;default:M.dialog.error(T("must_select_method"))}return t}},{key:"processQuery",value:function(e){var t=document.querySelector("#m-filteredsearch-options-container"),r=document.querySelector("#m-filteredsearch-options-buttons");switch(e.target.getAttribute("id")){case"aceptar-btn":void 0===this.layer_?M.dialog.error(T("must_select_layer")):("1"===this.selectionMethod&&(this.oldFilter=void 0,this.oldLayer=void 0),this.setNewFilter(),this.isValidQuery&&void 0!==this.selectionMethod&&this.setOkButtons());break;case"limpiar-busqueda-btn":this.cleanSearch();break;case"limpiar-filtro-btn":this.layer_.removeFilter(),this.setInitialButtons(r);break;case"vertabla-btn":this.saveResultsOnTable(),t.innerHTML="",t.appendChild(this.filterResults),this.setTableViewButtons(r);break;case"exportar-btn":this.exportResults();break;case"guardar-btn":this.isValidQuery?this.myqueries.push({query:this.sqlQuery,layer:this.layer_}):M.dialog.error(T("invalid_query"));break;case"misconsultas-btn":this.myQueriesClick(t),this.showMyQueriesViewButtons(r);break;case"volver-btn":if(t.innerHTML="",t.appendChild(this.initialView),this.setOkButtons(),void 0!==this.clickedQuery){document.getElementById("m-filteredsearch-textArea").value=this.clickedQuery.query;for(var n=document.getElementById("m-filteredsearch-layers-select"),i=0;i<n.options.length;i++)n.options[i].value===this.clickedQuery.layer.name&&(n.options.selectedIndex=[i]);this.clickedQuery=void 0}document.querySelector("#guardar-btn").style.display="none"}}},{key:"myQueriesClick",value:function(e){var t=e;t.innerHTML="",this.compileMyQueriesTemplate(),this.addSavedQueryClick(),t.appendChild(this.savedQueriesView)}},{key:"addSavedQueryClick",value:function(){var e=this;this.savedQueriesView.querySelectorAll("td").forEach((function(t,r){t.addEventListener("click",(function(n){e.savedQueryClicked(n,t,r)}))}))}},{key:"savedQueryClicked",value:function(e,t,r){var n=this;this.deleteAppliedFilters(),this.clickedQuery=this.myqueries[r],this.mapeaFilterQuery=this.turnStringIntoQuery(this.clickedQuery.query),this.layer_=this.clickedQuery.layer,this.layer_.setFilter(this.mapeaFilterQuery),Array.prototype.forEach.call(e.target.parentNode.parentNode.parentNode.children[0].children,(function(e){Array.prototype.forEach.call(e.children,(function(e){e.classList.remove("focus")}))})),e.target.classList.add("focus");var i=document.querySelector("#m-filteredsearch-options-buttons").querySelector("#eliminar-btn");i.style.display="inline",i.onclick=function(){n.deleteSavedQuery(t,r),n.compileMyQueriesTemplate(),n.addSavedQueryClick(),document.querySelector("#m-filteredsearch-options-container").appendChild(n.savedQueriesView)}}},{key:"deleteSavedQuery",value:function(e,t){this.myqueries.splice(t,1),e.parentNode.remove(),document.querySelector("#m-filteredsearch-options-buttons").querySelector("#eliminar-btn").style.display="none",this.sqlQuery="",this.layer_.removeFilter(),0===this.myqueries.length&&(document.querySelector("#m-filteredsearch-options-container").innerHTML=T("no_saved_queries"))}},{key:"compileMyQueriesTemplate",value:function(){if(void 0!==this.savedQueriesView)for(var e=this.savedQueriesView.lastElementChild;e;)e.remove(),e=this.savedQueriesView.lastElementChild;this.mySqlQueries=this.myqueries.map((function(e){var t=e;return t.query=e.query.replace(/\.\*/g,"%").replace(/\./g,"_"),t})),this.savedQueriesView=M.template.compileSync(k.a,{vars:{queries:this.mySqlQueries,translations:{no_saved_queries:T("no_saved_queries")}}})}},{key:"deleteAppliedFilters",value:function(){this.map.getWFS().concat(this.map.getKML().concat(this.map.getLayers().filter((function(e){return"GeoJSON"===e.type})))).forEach((function(e){null!==e.getFilter&&e.removeFilter()}))}},{key:"setNewFilter",value:function(){if(""===this.sqlQuery)M.dialog.error(T("must_query")),this.mapeaFilterQuery=this.oldFilter,this.layer_=this.oldLayer;else if(void 0!==this.oldLayer&&this.oldLayer!==this.layer_)M.dialog.error(T("cant_apply")),this.mapeaFilterQuery=this.oldFilter,this.layer_=this.oldLayer;else{var e;try{if(e=this.turnStringIntoQuery(this.sqlQuery),e=this.getMethodFilter(e),this.layer_.setFilter(e),null===this.layer_.getFilter())throw this.isValidQuery=!1,new Error(T("invalid_filter"));this.mapeaFilterQuery=e,this.oldFilter=this.mapeaFilterQuery,this.oldLayer=this.layer_,this.isValidQuery=!0}catch(e){this.isValidQuery=!1,M.dialog.error(T("cant_apply_filter"))}}}},{key:"exportResults",value:function(){var e=this.layer_.getFeatures();if(e.length>0){var t=this.dataToCsv(e);this.downloadCsv(t)}else M.dialog.error(T("no_export_data"))}},{key:"dataToCsv",value:function(e){var t="",r=Object.keys(e[0].getAttributes());return r.forEach((function(e){t+="".concat(e,",")})),t="".concat(t.substring(0,t.length-1),"\n"),e.forEach((function(e){var n=e.getAttributes();r.forEach((function(e){t+=n[e],t+=","})),t="".concat(t.substring(0,t.length-1),"\n")})),t=t.substring(0,t.length-1)}},{key:"downloadCsv",value:function(e){var t="data:text/csv;charset=utf-8,".concat(encodeURI(e)),r=document.createElement("a");r.href=t,r.download="queryresults.csv",r.click()}},{key:"setInitialButtons",value:function(e){var t=e;t.querySelector("#volver-btn").style.display="none",t.querySelector("#aceptar-btn").style.display="inline",t.querySelector("#limpiar-busqueda-btn").style.display="inline",t.querySelector("#limpiar-filtro-btn").style.display="inline",t.querySelector("#vertabla-btn").style.display="none",t.querySelector("#exportar-btn").style.display="none",t.querySelector("#guardar-btn").style.display="none",t.querySelector("#misconsultas-btn").style.display="inline",t.querySelector("#eliminar-btn").style.display="none"}},{key:"setOkButtons",value:function(){document.querySelector("#volver-btn").style.display="none",document.querySelector("#aceptar-btn").style.display="inline",document.querySelector("#limpiar-busqueda-btn").style.display="inline",document.querySelector("#limpiar-filtro-btn").style.display="inline",document.querySelector("#vertabla-btn").style.display="inline",document.querySelector("#exportar-btn").style.display="inline",document.querySelector("#guardar-btn").style.display="inline",document.querySelector("#misconsultas-btn").style.display="inline",document.querySelector("#eliminar-btn").style.display="none"}},{key:"setTableViewButtons",value:function(e){var t=e;t.querySelector("#volver-btn").style.display="inline",t.querySelector("#aceptar-btn").style.display="none",t.querySelector("#limpiar-busqueda-btn").style.display="none",t.querySelector("#limpiar-filtro-btn").style.display="none",t.querySelector("#vertabla-btn").style.display="none",t.querySelector("#exportar-btn").style.display="none",t.querySelector("#guardar-btn").style.display="none",t.querySelector("#misconsultas-btn").style.display="none"}},{key:"showMyQueriesViewButtons",value:function(e){var t=e;t.querySelector("#volver-btn").style.display="inline",t.querySelector("#aceptar-btn").style.display="none",t.querySelector("#limpiar-busqueda-btn").style.display="none",t.querySelector("#limpiar-filtro-btn").style.display="none",t.querySelector("#vertabla-btn").style.display="none",t.querySelector("#exportar-btn").style.display="none",t.querySelector("#guardar-btn").style.display="none",t.querySelector("#misconsultas-btn").style.display="none"}},{key:"cleanSearch",value:function(){document.querySelector(".filtered-search-panel").querySelector("textarea").value="",document.querySelector("#m-filteredsearch-method-select").value=T("select_method"),this.selectionMethod="",this.sqlQuery="",document.querySelector("#m-filteredsearch-layers-select").querySelector("#layers0").selected=!0,document.querySelector("#m-filteredsearch-fields").innerHTML='<p class="m-filteredsearch-headers">'.concat(T("fields"),"</p>"),document.querySelector("#m-filteredsearch-values").innerHTML='<p class="m-filteredsearch-headers">'.concat(T("values"),"</p>")}},{key:"showTableViewPage",value:function(e){var t=this;this.filterResults.querySelector("#queryresults").innerHTML="";var r=this.layer_.getFeatures()[0].getAttributes(),n=document.createElement("tr");Object.keys(r).forEach((function(e){var t=document.createElement("th"),r=document.createTextNode(e);t.appendChild(r),n.appendChild(t)})),this.filterResults.querySelector("#queryresults").appendChild(n),this.filterResults.querySelector("#paginationbuttons>#pageNumBtn").innerHTML="".concat(this.resultsPage+1," de ").concat(e.length),e[this.resultsPage].forEach((function(e){n=document.createElement("tr");var r=e.getAttributes();Object.keys(r).forEach((function(e){var t=document.createElement("td"),i=document.createTextNode(r[e].toString());t.appendChild(i),n.appendChild(t)})),t.filterResults.querySelector("#queryresults").appendChild(n)}))}},{key:"saveResultsOnTable",value:function(){var e=this;if(this.layer_.getFeatures().length>0){var t=this.divideList(this.layer_.getFeatures());this.showTableViewPage(t),this.filterResults.querySelectorAll("#paginationbuttons>button").forEach((function(r){r.addEventListener("click",(function(r){"prevBtn"===r.target.id?e.resultsPage=e.resultsPage>0?e.resultsPage-=1:e.resultsPage:e.resultsPage=e.resultsPage<t.length-1?e.resultsPage+=1:e.resultsPage,e.showTableViewPage(t)}))}))}else this.filterResults.innerHTML=T("no_entities")}},{key:"operatorClick",value:function(e,t){var r=document.querySelector(".filtered-search-panel").querySelector("textarea");switch(t.innerHTML){case"()":0===this.parenthesesClick?(r.value+="(",this.sqlQuery+="(",this.parenthesesClick=1):(r.value+=")",this.sqlQuery+=")",this.parenthesesClick=0);break;case"&#61;":r.value+=" = ",this.sqlQuery+=" = ";break;case"&lt;":r.value+=" < ",this.sqlQuery+=" < ";break;case"&gt;":r.value+=" > ",this.sqlQuery+=" > ";break;case"&lt;&gt;":r.value+=" <> ",this.sqlQuery+=" <> ";break;case"&gt;=":r.value+=" >= ",this.sqlQuery+=" >= ";break;case"&lt;=":r.value+=" <= ",this.sqlQuery+=" <= ";break;case"_":r.value+="_",this.sqlQuery+=".";break;case"%":r.value+="%",this.sqlQuery+=".*";break;default:r.value+=" ".concat(t.innerHTML.toLowerCase()," "),this.sqlQuery+=" ".concat(t.innerHTML.toLowerCase()," ")}}},{key:"showLayerFields",value:function(e){var t=this;if(M.utils.isNullOrEmpty(e)||(this.layer_=this.hasLayer_(e)[0]),this.isLayerLoaded(this.layer_)){this.fieldValues=[];var r=this.layer_.getFeatures();if(this.oldFilter=this.mapeaFilterQuery,this.oldLayer=this.layer_,document.querySelector(".filtered-search-panel").querySelector("textarea").value="",this.sqlQuery="",this.mapeaFilterQuery=null,!M.utils.isNullOrEmpty(r)){this.fields=Object.keys(r[0].getAttributes()),r.forEach((function(e){var r=Object.values(e.getAttributes());M.utils.isNullOrEmpty(r)||t.fieldValues.push(r)})),this.fieldsPages=this.divideList(this.fields);var n={jsonp:!0,vars:{fields:this.fieldsPages[0]}};this.fieldsTemplate=M.template.compileSync(h.a,n),this.fieldsTemplate.querySelector("#pageNumBtn").innerHTML="1 de ".concat(this.fieldsPages.length),document.querySelector("#m-filteredsearch-fields").innerHTML='<p class="m-filteredsearch-headers">'.concat(T("fields"),"</p>"),document.querySelector("#m-filteredsearch-fields").appendChild(this.fieldsTemplate),this.showFields(),this.addpageBtnEvt()}}else M.dialog.error(T("layer_load"))}},{key:"isLayerLoaded",value:function(e){var t=!1,r=!!this.kmlLayers.find((function(t){return t.layer===e}))&&this.kmlLayers.find((function(t){return t.layer===e})).loaded;return(e.type&&"KML"!==e.type&&e.getImpl().isLoaded()||r)&&(t=!0),t}},{key:"showFields",value:function(){var e=this;document.querySelector("#m-filteredsearch-fields").querySelectorAll("td").forEach((function(t){var r=[],n=e.fields.indexOf(t.innerHTML);e.fieldValues.forEach((function(e){r.push(e[n])})),t.addEventListener("click",(function(t){document.querySelector(".filtered-search-panel").querySelector("textarea").value+=t.target.innerHTML,e.sqlQuery+=t.target.innerHTML,e.selectField(r),Array.prototype.forEach.call(t.target.parentNode.parentNode.parentNode.children[0].children,(function(e){Array.prototype.forEach.call(e.children,(function(e){e.classList.remove("focus")}))})),t.target.classList.add("focus")}))}))}},{key:"addpageBtnEvt",value:function(){var e=this;this.fieldsTemplate.querySelectorAll("#m-attributetable-tfoot>button").forEach((function(t){t.addEventListener("click",(function(t){return e.changePage(t,"fields",e.fieldsPages.length)}))})),this.valuesTemplate.querySelectorAll("#m-attributetable-tfoot>button").forEach((function(t){t.addEventListener("click",(function(t){return e.changePage(t,"values",e.valuesPages.length)}))}))}},{key:"divideList",value:function(e){for(var t=[],r=0;r<e.length;){for(var n=[],i=r;i<r+5;i+=1)n.push(e[i]),i+1===e.length&&(i=r+5);t.push(n),r+=5}return t}},{key:"changePage",value:function(e,t,r){var n="fields"===t?this.currentFieldsPage:this.currentValuesPage;n="prevBtn"===e.target.id?n>0?n-=1:n:n<r-1?n+=1:n,"fields"===t?this.currentFieldsPage=n:this.currentValuesPage=n,this.showPageResults(t),this.addpageBtnEvt()}},{key:"showPageResults",value:function(e){var t=this;if("fields"===e){var r={jsonp:!0,vars:{fields:this.fieldsPages[this.currentFieldsPage]}};this.fieldsTemplate=M.template.compileSync(h.a,r),this.fieldsTemplate.querySelector("#pageNumBtn").innerHTML="".concat(this.currentFieldsPage+1," de ").concat(this.fieldsPages.length),document.querySelector("#m-filteredsearch-fields").innerHTML='<p class="m-filteredsearch-headers">'.concat(T("fields"),"</p>"),document.querySelector("#m-filteredsearch-fields").appendChild(this.fieldsTemplate),this.showFields()}else{var n={jsonp:!0,vars:{values:this.valuesPages[this.currentValuesPage]}};this.valuesTemplate=M.template.compileSync(m.a,n),this.valuesTemplate.querySelector("#pageNumBtn").innerHTML="".concat(this.currentValuesPage+1," de ").concat(this.valuesPages.length),this.fieldsTemplate.querySelector("#pageNumBtn").innerHTML="".concat(this.currentFieldsPage+1," de ").concat(this.fieldsPages.length),document.querySelector("#m-filteredsearch-values").innerHTML='<p class="m-filteredsearch-headers">'.concat(T("values"),"</p>"),document.querySelector("#m-filteredsearch-values").appendChild(this.valuesTemplate),document.querySelector("#m-filteredsearch-values").querySelectorAll("td").forEach((function(e){e.addEventListener("click",(function(e){document.querySelector(".filtered-search-panel").querySelector("textarea").value+=e.target.innerHTML,t.sqlQuery+=e.target.innerHTML,Array.prototype.forEach.call(e.target.parentNode.parentNode.parentNode.children[0].children,(function(e){Array.prototype.forEach.call(e.children,(function(e){e.classList.remove("focus")}))})),e.target.classList.add("focus")}))}))}}},{key:"selectField",value:function(e){var t=this,r=e.filter((function(e,t,r){return r.indexOf(e)===t}));this.valuesPages=this.divideList(r);var n={jsonp:!0,vars:{values:this.valuesPages[0]}};this.currentFieldsPage=0,this.currentValuesPage=0,this.valuesTemplate=M.template.compileSync(m.a,n),this.valuesTemplate.querySelector("#pageNumBtn").innerHTML="".concat(this.currentValuesPage+1," de ").concat(this.valuesPages.length),this.valuesTemplate.querySelectorAll("#m-filteredsearch-valuestable>tbody>tr>td").forEach((function(e){e.addEventListener("click",(function(e){return t.selectValue(e)}))})),document.querySelector("#m-filteredsearch-values").innerHTML="<p class='m-filteredsearch-headers'>".concat(T("values"),"</p>"),document.querySelector("#m-filteredsearch-values").appendChild(this.valuesTemplate),this.addpageBtnEvt()}},{key:"selectValue",value:function(e){document.querySelector(".filtered-search-panel").querySelector("textarea").value+=e.currentTarget.innerHTML,this.sqlQuery+=e.currentTarget.innerHTML,Array.prototype.forEach.call(e.currentTarget.parentNode.parentNode.children,(function(e){e.children[0].classList.remove("focus")})),e.currentTarget.classList.add("focus")}},{key:"hasLayer_",value:function(e){var t=[];return!M.utils.isNullOrEmpty(e)&&(M.utils.isArray(e)||M.utils.isString(e)||e instanceof M.Layer)?(M.utils.isString(e)&&this.map.getLayers().forEach((function(r){r.name===e&&t.push(r)})),e instanceof M.Layer&&this.map.getLayers().forEach((function(r){r.equals(e)&&t.push(r)})),M.utils.isArray(e)&&this.map.getLayers().forEach((function(r){e.indexOf(r.name)>=0&&t.push(r)})),t):(M.dialog.error(T("hasLayer_error"),T("error")),t)}},{key:"equals",value:function(e){return e instanceof a}}])&&C(t.prototype,r),n&&C(t,n),a}(),I=r(8);function H(e){return(H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function D(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function G(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function W(e,t){return(W=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function K(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=z(e);if(t){var i=z(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Y(this,r)}}function Y(e,t){return!t||"object"!==H(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function z(e){return(z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var J=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&W(e,t)}(a,M.Plugin);var t,r,n,i=K(a);function a(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return D(this,a),(e=i.call(this)).map_=null,e.controls_=[],e.position_=t.position||"TR",e.metadata_=I.metadata,e}return t=a,(r=[{key:"addTo",value:function(e){var t={pluginOnLeft:!!["TL","BL"].includes(this.position_)};this.control_=new B(t),this.controls_.push(this.control_),this.map_=e,this.panel_=new M.ui.Panel("panelFilteredSearch",{className:"filtered-search-panel",collapsible:!0,position:M.ui.position[this.position_],collapsedButtonClass:"g-plugin-filteredsearch-filter",tooltip:T("tooltip")}),this.panel_.addControls(this.controls_),e.addPanels(this.panel_)}},{key:"destroy",value:function(){this.map_.removeControls(this.controls_);var e=[null,null,null,null];this.map_=e[0],this.control_=e[1],this.controls_=e[2],this.panel_=e[3]}},{key:"getMetadata",value:function(){return this.metadata_}},{key:"name",get:function(){return"filteredsearch"}}])&&G(t.prototype,r),n&&G(t,n),a}();window.M.plugin||(window.M.plugin={}),window.M.control||(window.M.control={}),window.M.impl||(window.M.impl={}),window.M.impl.control||(window.M.impl.control={}),window.M.plugin.FilteredSearch=J,window.M.control.FilteredSearchControl=B,window.M.impl.control.FilteredSearchControl=d}]);
//# sourceMappingURL=filteredsearch.ol.min.js.map