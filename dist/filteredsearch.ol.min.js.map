{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/templates/valuestable.html","webpack:///./src/templates/fieldstable.html","webpack:///./src/templates/filteredsearch.html","webpack:///./src/templates/seeresults.html","webpack:///./src/templates/initialview.html","webpack:///./src/templates/savedqueries.html","webpack:///./src/impl/ol/js/filteredsearchcontrol.js","webpack:///./src/facade/js/i18n/language.js","webpack:///./src/facade/js/filteredsearchcontrol.js","webpack:///./src/facade/js/filteredsearch.js","webpack:///./src/index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","FilteredSearchControl","M","impl","Control","map","html","translations","en","es","getLang","res","language","getTranslation","lang","getValue","keyPath","translation","utils","isNullOrEmpty","console","warn","split","reduce","prev","current","values","isUndefined","FilteredSearchImplControl","exception","pluginOnLeft","sqlQuery","mapeaFilterQuery","myqueries","parenthesesClick","operators","operatorCodes","fieldsPages","valuesPages","fields","fieldValues","currentFieldsPage","currentValuesPage","resultsPage","kmlLayers","this","Promise","success","fail","createInitialView","document","querySelector","addEventListener","evt","buttonOpened","classList","add","template","compileSync","vars","title","return_btn","accept_btn","clear_search","clear_filter","see_table","export","save","my_queries","remove_queries","appendChild","initialView","filterResults","seeResults","valuesTemplate","jsonp","addEvents","htmlSelect","subscribeActionLayer","setInitialButtons","getKML","layer","loaded","showLayerFields","target","selectedIndex","getAttribute","selectionMethod","querySelectorAll","forEach","element","e","operatorClick","btn","processQuery","replace","kmlLayer","on","LOAD","filter","options","layers","getLayers","Vector","select_layer","method","select_method","new_select","previous_selection","previous_remove","previous_add","filter_exp","placeholder","operator","btnTextNode","createTextNode","buttonNode","createElement","stringQ","pieces","nextOperator","findNextOperator","isThisTheLastOperator","substring","indexes","trim","translateOrderToQuery","saveOperands","length","turnStringIntoQuery","REMOVED_LAYER","Array","isArray","removeLayerOption","ADDED_LAYER","addLayerOption","layerName","isNotAdded","htmlOption","setAttribute","innerText","select","children","opt","removeChild","some","innerHTML","query","charAt","findClosingParentheses","operatorInWord","isLastOp","ops","cutQuery","v","operatorContainedInQuery","indexOf","possibleOperatorIndexes","operatorNotInWord","startEndIndexes","operands","startSplitIndex","endSplitIndex","push","operand","newOperand","mFilter","EQUAL","attr","val","Function","feature","LT","GT","LTE","GTE","AND","OR","LIKE","NOT","openingIndex","closingParenthesesIndex","parenthesesCounter","operatorIndexes","inWord","previousChar","nextChar","undefined","match","index","position","isMFilterPar","includes","mapeaFilter","combinedFilter","oldFilter","dialog","error","optsContainer","btnContainer","layer_","oldLayer","setNewFilter","isValidQuery","setOkButtons","cleanSearch","removeFilter","saveResultsOnTable","setTableViewButtons","exportResults","myQueriesClick","showMyQueriesViewButtons","clickedQuery","getElementById","Select","style","display","container","compileMyQueriesTemplate","addSavedQueryClick","savedQueriesView","td","idx","savedQueryClicked","deleteAppliedFilters","setFilter","parentNode","row","rowCell","remove","deleteBtn","onclick","deleteSavedQuery","splice","child","lastElementChild","mySqlQueries","q","newQuery","savedQueries","queries","no_saved_queries","getWFS","concat","type","getFilter","tryFilter","getMethodFilter","Error","err","features","getFeatures","csvString","dataToCsv","downloadCsv","csv","featureKeys","keys","getAttributes","featureAttrs","csvdata","fileUrl","encodeURI","hiddenLink","href","download","click","panelContainer","selected","pages","attributes","newLine","attributeKey","newTitleCell","cellText","filteredFeature","filteredAttributes","newCell","txt","toString","divideList","showTableViewPage","id","txtarea","toLowerCase","hasLayer_","isLayerLoaded","properties","fieldsTemplate","showFields","addpageBtnEvt","isLoaded","kmlLayerLoaded","find","getImpl","cell","fieldIndex","selectField","changePage","items","firstItem","newPage","fieldsOrValues","numberOfPages","currentPage","showPageResults","self","tableCell","selectValue","currentTarget","layerSearch","layersFind","isString","Layer","lay","equals","control","FilteredSearch","Plugin","map_","controls_","position_","metadata_","api","metadata","control_","panel_","ui","Panel","className","collapsible","collapsedButtonClass","tooltip","addControls","addPanels","removeControls","window","plugin","M$plugin$FilteredSearch","M$control$FilteredSearchControl","M$impl$control$FilteredSearchControl"],"mappings":"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","file":"filteredsearch.ol.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 11);\n","module.exports = \"<div>\\n    <table id=\\\"m-filteredsearch-valuestable\\\">\\n        <tbody>\\n            {{#each values}}\\n                <tr>\\n                    <td>{{this}}</td>\\n                </tr>\\n            {{/each}}\\n        </tbody>\\n    </table>\\n    <div id=\\\"m-attributetable-tfoot\\\">\\n        <button id=\\\"prevBtn\\\">&#8810;</button>\\n        <span id=\\\"pageNumBtn\\\"></span>\\n        <button id=\\\"nextBtn\\\">&#8811;</button>\\n    </div>\\n</div>\";","module.exports = \"<div>\\n    <table id=\\\"m-filteredsearch-fieldstable\\\">\\n        <tbody>\\n            {{#each fields}}\\n                <tr>\\n                    <td>{{this}}</td>\\n                </tr>\\n            {{/each}}\\n        </tbody>\\n    </table>\\n    <div id=\\\"m-attributetable-tfoot\\\">\\n        <button id=\\\"prevBtn\\\">&#8810;</button>\\n        <span id=\\\"pageNumBtn\\\"></span>\\n        <button id=\\\"nextBtn\\\">&#8811;</button>\\n    </div>\\n</div>\";","module.exports = \"<div id=\\\"div-contenedor\\\" class=\\\"m-control m-container m-filteredsearch\\\">\\n\\n    <div class=\\\"title\\\">{{translations.title}}</div>\\n\\n    <div id=\\\"m-filteredsearch-options-container\\\"></div>\\n\\n    <div id=\\\"m-filteredsearch-options-buttons\\\">\\n        <button id=\\\"volver-btn\\\">{{translations.return_btn}}</button>\\n        <button id=\\\"aceptar-btn\\\">{{translations.accept_btn}}</button>\\n        <button id=\\\"limpiar-busqueda-btn\\\">{{translations.clear_search}}</button>\\n        <button id=\\\"limpiar-filtro-btn\\\">{{translations.clear_filter}}</button>\\n        <button id=\\\"vertabla-btn\\\">{{translations.see_table}}</button>\\n        <button id=\\\"exportar-btn\\\">{{translations.export}}</button>\\n        <button id=\\\"guardar-btn\\\">{{translations.save}}</button>\\n        <button id=\\\"misconsultas-btn\\\">{{translations.my_queries}}</button>\\n        <button id=\\\"eliminar-btn\\\">{{translations.remove_queries}}</button>\\n    </div>\\n\\n</div>\";","module.exports = \"<div>\\n    <table id='queryresults'></table>\\n    <div id=\\\"paginationbuttons\\\">\\n        <button id=\\\"prevBtn\\\">&#8810;</button>\\n        <span id=\\\"pageNumBtn\\\"></span>\\n        <button id=\\\"nextBtn\\\">&#8811;</button>\\n    </div>\\n</div>\";","module.exports = \"<div id=\\\"m-filteredsearch-initialview\\\">\\n    <div id=\\\"m-filteredsearch-selects-container\\\">\\n        <p class=\\\"m-filteredsearch-headers\\\">{{translations.layer}}</p>\\n        <select id=\\\"m-filteredsearch-layers-select\\\">\\n            <option disabled=\\\"disabled\\\" id=\\\"layers0\\\" selected=\\\"selected\\\">{{translations.select_layer}}</option>\\n            {{#each layers}}\\n                <option name=\\\"{{this.name}}\\\">{{this.name}}</option>\\n            {{/each}}\\n        </select>\\n        <p class=\\\"m-filteredsearch-headers\\\">{{translations.method}}</p>\\n        <select id=\\\"m-filteredsearch-method-select\\\">\\n            <option disabled=\\\"disabled\\\" selected=\\\"selected\\\" value=\\\"0\\\">{{translations.select_method}}</option>\\n            <option value=\\\"1\\\">{{translations.new_select}}</option>\\n            <option value=\\\"2\\\">{{translations.previous_selection}}</option>\\n            <option value=\\\"3\\\">{{translations.previous_remove}}</option>\\n            <option value=\\\"4\\\">{{translations.previous_add}}</option>\\n        </select>\\n    </div>\\n\\n    <div id=\\\"m-filteredsearch-lists-container\\\">\\n        <div id=\\\"m-filteredsearch-fields\\\">\\n            <p class=\\\"m-filteredsearch-headers\\\">{{translations.fields}}</p>\\n            <!-- Insert here fieldstable.html template. -->\\n        </div>\\n        <div id=\\\"m-filteredsearch-values\\\">\\n            <p class=\\\"m-filteredsearch-headers\\\">{{translations.values}}</p>\\n            <!-- Insert here valuestable.html template. -->\\n        </div>\\n    </div>\\n\\n    <div id=\\\"m-filteredsearch-operators-container\\\">\\n        <p class=\\\"m-filteredsearch-headers\\\">{{translations.operators}}</p>\\n        <!-- Insert here operator buttons. -->\\n    </div>\\n\\n    <div id=\\\"m-filteredsearch-query-container\\\">\\n        <p class=\\\"m-filteredsearch-headers\\\">{{translations.filter_exp}}</p>\\n        <textarea id=\\\"m-filteredsearch-textArea\\\" cols=\\\"90\\\" rows=\\\"5\\\" placeholder=\\\"{{translations.placeholder}}\\\"></textarea>\\n    </div>\\n</div>\";","module.exports = \"<div>\\n    {{#if queries}}\\n        <table>\\n            {{#each queries}}\\n                <tr>\\n                    <td>{{this.query}}</td>\\n                </tr>\\n            {{/each}}\\n        </table>\\n    {{else}}\\n        <p>{{translations.no_saved_queries}}</p>\\n    {{/if}}\\n</div>\";","/**\n * @module M/impl/control/FilteredSearchControl\n */\nexport default class FilteredSearchControl extends M.impl.Control {\n  /**\n   * This function adds the control to the specified map\n   *\n   * @public\n   * @function\n   * @param {M.Map} map to add the plugin\n   * @param {HTMLElement} html of the plugin\n   * @api stable\n   */\n  addTo(map, html) {\n    // obtengo la interacción por defecto del dblclick para manejarla\n    super.addTo(map, html);\n  }\n}\n","import en from './en';\nimport es from './es';\n\n/**\n * Default object with es and en translate.\n *\n * @const\n * @type {object}\n */\nconst translations = {\n  en,\n  es,\n};\n\nconst getLang = () => {\n  let res = 'es';\n  if (typeof M.language.getLang === 'function') {\n    res = M.language.getLang();\n  }\n\n  return res;\n};\n\n/**\n * This function sets a new language translate.\n * @param {string} lang\n * @param {JSON} json\n * @public\n * @api\n */\nexport const addTranslation = (lang, json) => {\n  translations[lang] = json;\n};\n\n/**\n * This function gets a language translate.\n *\n * @param {string} lang\n * @return {JSON}\n * @public\n * @api\n */\nexport const getTranslation = (lang) => {\n  return translations[lang];\n};\n\n/**\n * This function gets a language value from key\n *\n * @public\n * @param {string}\n * @param {string}\n * @return {string}\n * @public\n * @api\n */\n\nexport const getValue = (keyPath, lang = getLang()) => {\n  const translation = getTranslation(lang);\n  let value = '';\n  if (M.utils.isNullOrEmpty(translation)) {\n    /* eslint-disable no-console */\n    console.warn(`The translation '${lang}' has not been defined.`);\n  } else {\n    value = keyPath.split('.').reduce((prev, current) => prev[current], translation);\n  }\n\n  return value;\n};\n","/**\n * @module M/control/FilteredSearchControl\n */\n\nimport FilteredSearchImplControl from 'impl/filteredsearchcontrol';\nimport template from 'templates/filteredsearch';\nimport fieldsTemplate from 'templates/fieldstable';\nimport valuesTemplate from 'templates/valuestable';\nimport seeResults from 'templates/seeresults';\nimport initialView from 'templates/initialview';\nimport savedQueries from 'templates/savedqueries';\nimport { getValue } from './i18n/language';\n\nexport default class FilteredSearchControl extends M.Control {\n  /**\n   * @classdesc\n   * Main constructor of the class. Creates a PluginControl\n   * control\n   *\n   * @constructor\n   * @extends {M.Control}\n   * @api stable\n   */\n  constructor(values) {\n    if (M.utils.isUndefined(FilteredSearchImplControl)) {\n      M.exception('La implementación usada no puede crear controles FilteredSearchControl');\n    }\n    const impl = new FilteredSearchImplControl();\n    super(impl, 'FilteredSearch');\n    this.pluginOnLeft = values.pluginOnLeft;\n    /**\n     * Filtering query (written in sql style)\n     * @public\n     */\n    this.sqlQuery = '';\n\n    /**\n     * Mapea filter with the user's query.\n     * @public\n     */\n    this.mapeaFilterQuery = null;\n\n    /**\n     * Saved queries\n     * @public\n     */\n    this.myqueries = [];\n\n    /**\n     * Parentheses click counter\n     * @public\n     * If 0, a '(' is written. If 1, a ')'.\n     */\n    this.parenthesesClick = 0;\n\n    /**\n     * Operators for creating queries\n     * @public\n     */\n    this.operators = ['=', '<', '>', '<=', '>=', '<>', '()', 'and', 'or', 'not', 'like', '%', '_'];\n\n    /**\n     * Operators html codes.\n     * @public\n     */\n    this.operatorCodes = ['&#61;', '&lt;', '&gt;'];\n\n    /**\n     * Layer fields items divided by page.\n     * format: [[item_1, item_2, item_3], [i4, i5, i6], ... ]\n     * @public\n     */\n    this.fieldsPages = [];\n\n    /**\n     * Layer field values items divided by page.\n     * format: [[item_1, item_2, item_3], [i4, i5, i6], ... ]\n     * @public\n     */\n    this.valuesPages = [];\n\n    /**\n     * Selected layer attributes list.\n     * @public\n     */\n    this.fields = [];\n\n    /**\n     * Possible values for all fields of the selected layer.\n     * @public\n     */\n    this.fieldValues = [];\n\n    /**\n     * Fields page counter\n     * @public\n     */\n    this.currentFieldsPage = 0;\n\n    /**\n     * Field values page counter.\n     * @public\n     */\n    this.currentValuesPage = 0;\n\n    /**\n     * Table view results page counter.\n     * @public\n     */\n    this.resultsPage = 0;\n\n    /**\n     * KML layers added to map.\n     * @public\n     */\n    this.kmlLayers = [];\n  }\n\n  /**\n   * This function creates the view\n   *\n   * @public\n   * @function\n   * @param {M.Map} map to add the control\n   * @api stable\n   */\n  createView(map) {\n    this.map = map;\n    return new Promise((success, fail) => {\n      this.createInitialView(map);\n\n      // Desplazar open button\n      if (this.pluginOnLeft) {\n        document.querySelector('.m-panel.filtered-search-panel').querySelector('.m-panel-btn.g-plugin-filteredsearch-filter').addEventListener('click', (evt) => {\n          let buttonOpened = document.querySelector('.m-panel.filtered-search-panel.opened');\n          if (buttonOpened !== null) {\n            buttonOpened = buttonOpened.querySelector('.m-panel-btn.g-cartografia-flecha-izquierda');\n          }\n          if (buttonOpened && this.pluginOnLeft) {\n            buttonOpened.classList.add('opened-left');\n          }\n        });\n      }\n\n      const html = M.template.compileSync(template, {\n        vars: {\n          translations: {\n            title: getValue('title'),\n            return_btn: getValue('return'),\n            accept_btn: getValue('accept'),\n            clear_search: getValue('clear_search'),\n            clear_filter: getValue('clear_filter'),\n            see_table: getValue('see_table'),\n            export: getValue('export'),\n            save: getValue('save'),\n            my_queries: getValue('my_queries'),\n            remove_queries: getValue('remove_queries'),\n          },\n        },\n      });\n      html.querySelector('#m-filteredsearch-options-container').appendChild(this.initialView);\n      this.filterResults = M.template.compileSync(seeResults);\n      this.valuesTemplate = M.template\n        .compileSync(valuesTemplate, { jsonp: true, vars: { values: [] } });\n      this.addEvents(html);\n      const htmlSelect = html.querySelector('#m-filteredsearch-layers-select');\n      this.subscribeActionLayer(htmlSelect);\n      this.setInitialButtons(html);\n      this.kmlLayers = this.map.getKML().map((layer) => {\n        return { layer, loaded: false };\n      });\n      success(html);\n    });\n  }\n\n  /**\n   * Adds event listeners to several HTML elements.\n   * @public\n   * @function\n   * @param {HTML Element} html - 'filteredsearch.html' template\n   * @api\n   */\n  addEvents(html) {\n    this.initialView.querySelector('#m-filteredsearch-layers-select').addEventListener('change', (evt) => {\n      this.showLayerFields(evt.target[evt.target.selectedIndex].getAttribute('name'));\n    });\n    this.initialView.querySelector('#m-filteredsearch-method-select').addEventListener('change', (evt) => {\n      this.selectionMethod = evt.target.value;\n    });\n    html.querySelectorAll('#m-filteredsearch-operators-container>button').forEach((element) => {\n      element.addEventListener('click', e => this.operatorClick(e, element));\n    });\n    html.querySelectorAll('#m-filteredsearch-options-buttons>button')\n      .forEach(btn => btn.addEventListener('click', (e) => {\n        this.processQuery(e);\n      }));\n    html.querySelector('#m-filteredsearch-query-container>textarea').addEventListener('input', (e) => {\n      this.sqlQuery = e.target.value.replace(/_/g, '.').replace(/%/g, '.*');\n      this.setInitialButtons(document.querySelector('#m-filteredsearch-options-buttons'));\n    });\n    // checks if KML layers are loaded and saves flag on this.kmlLayers object\n    this.map.getKML().forEach((kmlLayer) => {\n      kmlLayer.on(M.evt.LOAD, () => {\n        this.kmlLayers.filter((layer) => {\n          return layer.layer === kmlLayer;\n        })[0].loaded = true;\n      });\n    });\n  }\n\n  /**\n   * Creates initialview.html template dinamically.\n   * @public\n   * @function\n   * @api\n   * @param {Map} map\n   */\n  createInitialView(map) {\n    const options = {\n      jsonp: true,\n      vars: {\n        layers: map.getLayers()\n          .filter(layer => layer instanceof M.layer.Vector && layer.name !== '__draw__'),\n        translations: {\n          layer: getValue('layer'),\n          select_layer: getValue('select_layer'),\n          method: getValue('method'),\n          select_method: getValue('select_method'),\n          new_select: getValue('new_select'),\n          previous_selection: getValue('previous_selection'),\n          previous_remove: getValue('previous_remove'),\n          previous_add: getValue('previous_add'),\n          fields: getValue('fields'),\n          values: getValue('values'),\n          operators: getValue('operators'),\n          filter_exp: getValue('filter_exp'),\n          placeholder: getValue('placeholder'),\n        },\n      },\n    };\n    this.initialView = M.template.compileSync(initialView, options);\n    this.operators.forEach((operator) => {\n      const btnTextNode = document.createTextNode(operator);\n      const buttonNode = document.createElement('button');\n      buttonNode.appendChild(btnTextNode);\n      this.initialView.querySelector('#m-filteredsearch-operators-container').appendChild(buttonNode);\n    });\n  }\n\n  /**\n   * Turns sql-like query string into Mapea filter.\n   * @public\n   * @function\n   * @api\n   * @param { String } stringQ - sql-like query\n   */\n  turnStringIntoQuery(stringQ) {\n    let pieces = [];\n    let mapeaFilter;\n    const nextOperator = this.findNextOperator(stringQ);\n    if (!this.isThisTheLastOperator(stringQ, nextOperator)) {\n      pieces = this.saveOperands(stringQ, nextOperator.indexes);\n      for (let i = 0; i < pieces.length; i += 1) {\n        pieces[i] = this.turnStringIntoQuery(pieces[i]);\n      }\n    } else {\n      pieces[0] = stringQ.substring(0, nextOperator.indexes[0]).trim();\n      pieces[1] = stringQ.substring(nextOperator.indexes[1] + 1).trim();\n      mapeaFilter = this.translateOrderToQuery(nextOperator.operator, pieces);\n      return mapeaFilter;\n    }\n\n    mapeaFilter = this.translateOrderToQuery(nextOperator.operator, pieces);\n\n    return mapeaFilter;\n  }\n\n  /**\n   * Action layer in Selects layers\n   * @public\n   * @function\n   * @param {HTMLElement} html to add the plugin\n   * @api stable\n   */\n  subscribeActionLayer(html) {\n    // Subscribe remove layer event.\n    this.map.on(M.evt.REMOVED_LAYER, (layers) => {\n      if (Array.isArray(layers)) {\n        layers.filter(layer => layer instanceof M.layer.Vector)\n          .forEach(layer => this.removeLayerOption(html, layer));\n      } else if (layers instanceof M.layer.Vector) {\n        const layer = { ...layers };\n        this.removeLayerOption(html, layer);\n      }\n    });\n    // Subscribe add layer event.\n    this.map.on(M.evt.ADDED_LAYER, (layers) => {\n      if (Array.isArray(layers)) {\n        layers.filter(layer => layer instanceof M.layer.Vector)\n          .forEach(layer => this.addLayerOption(html, layer));\n      } else if (layers instanceof M.layer.Vector) {\n        const layer = { ...layers };\n        this.addLayerOption(html, layer);\n      }\n    });\n  }\n\n  /**\n   * Add html option in Selects.\n   * @public\n   * @function\n   * @param { HTMLElement } html to add the plugin\n   * @api stable\n   */\n  addLayerOption(htmlSelect, layer) {\n    const layerName = layer.name;\n    if (layerName !== 'cluster_cover' && this.isNotAdded(layerName, htmlSelect)) {\n      const htmlOption = document.createElement('option');\n      htmlOption.setAttribute('name', layerName);\n      htmlOption.innerText = layerName;\n      htmlSelect.add(htmlOption);\n    }\n  }\n\n  /**\n   * Remove html option in Selects.\n   * @public\n   * @function\n   * @param { HTMLElement } html to add the plugin\n   * @api stable\n   */\n  removeLayerOption(select, layer) {\n    const layerName = layer.name;\n    const htmlSelect = select;\n    if (layerName !== 'cluster_cover' && !this.isNotAdded(layerName, htmlSelect)) {\n      const arrayOptions = [...htmlSelect.children];\n      arrayOptions.forEach((opt) => {\n        if (opt.innerText === layerName) {\n          htmlSelect.removeChild(opt);\n          // htmlSelect.selectedIndex = 0;\n        }\n      });\n      htmlSelect.selectedIndex = 0;\n    }\n  }\n\n  /**\n   * Check if the layer is not added yet.\n   * @public\n   * @function\n   * @param { String } name of layer to add.\n   * @api stable\n   */\n  isNotAdded(layerName, htmlSelect) {\n    const aChildren = [...htmlSelect.children];\n    return !aChildren.some(o => o.innerHTML === layerName);\n  }\n\n  /**\n   * Finds the next most important operator on a string.\n   * @public\n   * @function\n   * @api\n   * @param {String} query - query string\n   */\n  findNextOperator(query) { // TODO: shorten this method\n    let operator = '';\n    const indexes = [];\n\n    // First, and/or search (outside parentheses)\n    for (let i = 0; i < query.length; i += 1) {\n      // avoids searching inside ()\n      if (query.charAt(i) === '(') {\n        const closingParenthesesIndex = this.findClosingParentheses(query, i);\n        i = closingParenthesesIndex + 1;\n      }\n\n      if ((query.substring(i, i + 3) === 'and' &&\n        !this.operatorInWord(query, [i, i + 2])) ||\n        (query.substring(i, i + 2) === 'or' &&\n          !this.operatorInWord(query, [i, i + 1]))\n      ) {\n        if (query.substring(i, i + 3) === 'and') {\n          operator = query.substring(i, i + 3);\n          indexes[0] = i;\n          indexes[1] = i + 2;\n        } else { // or\n          operator = query.substring(i, i + 2);\n          indexes[0] = i;\n          indexes[1] = i + 1;\n        }\n        i = query.length;\n      }\n    }\n\n    if (operator === '') {\n      for (let i = 0; i < query.length; i += 1) {\n        // avoids searching inside ()\n        if (query.charAt(i) === '(') {\n          const closingParenthesesIndex = this.findClosingParentheses(query, i);\n          i = closingParenthesesIndex + 1;\n        }\n\n        if ((query.substring(i, i + 3) === 'not' &&\n          !this.operatorInWord(query, [i, i + 2])) ||\n          (query.substring(i, i + 4) === 'like' &&\n            !this.operatorInWord(query, [i, i + 3]))) {\n          if (query.substring(i, i + 3) === 'not') {\n            operator = query.substring(i, i + 3);\n            indexes[0] = i;\n            indexes[1] = i + 2;\n          } else { // like\n            operator = query.substring(i, i + 4);\n            indexes[0] = i;\n            indexes[1] = i + 3;\n          }\n          i = query.length;\n        }\n      }\n    }\n\n    if (operator === '') {\n      for (let i = 0; i < query.length; i += 1) {\n        // avoids searching inside ()\n        if (query.charAt(i) === '(') {\n          const closingParenthesesIndex = this.findClosingParentheses(query, i);\n          i = closingParenthesesIndex + 1;\n        }\n\n        if (query.substring(i, i + 2) === '<=' ||\n          query.substring(i, i + 2) === '>=' ||\n          query.substring(i, i + 2) === '<>') {\n          operator = query.substring(i, i + 2);\n          indexes[0] = i;\n          indexes[1] = i + 1;\n          i = query.length;\n        } else if (query.charAt(i) === '=' || query.charAt(i) === '<' ||\n          query.charAt(i) === '>') {\n          operator = query.charAt(i);\n          indexes[0] = i;\n          indexes[1] = i;\n          i = query.length;\n        }\n      }\n    }\n\n    return { operator, indexes };\n  }\n\n  /**\n   * Checks if a string has any operators other than the given one.\n   * @function\n   * @public\n   * @param {String} query\n   * @param {String} operator\n   * @api\n   */\n  isThisTheLastOperator(query, operator) {\n    let isLastOp = true;\n    const ops = ['=', '<=', '>=', '<>', '(', 'and', 'or', 'not', 'like'];\n    const cutQuery = `${query.substring(0, operator.indexes[0])}${query.substring(operator.indexes[1] + 1)}`;\n    if (\n      ops.some((v) => {\n        const operatorContainedInQuery = cutQuery.indexOf(v) >= 0;\n        const possibleOperatorIndexes = [\n          cutQuery.indexOf(v),\n          (cutQuery.indexOf(v) + ops[ops.indexOf(v)].length) - 1,\n        ];\n        const operatorNotInWord = !this.operatorInWord(cutQuery, possibleOperatorIndexes);\n        return operatorContainedInQuery && operatorNotInWord;\n      })) {\n      isLastOp = false;\n    }\n    return isLastOp;\n  }\n\n  /**\n   * Splits string into operands by operator position.\n   * @public\n   * @function\n   * @api\n   * @param {String} query - query string\n   * @param {String} operator - calculation operator\n   * @param {Array} startEndIndexes - operands limits\n   */\n  saveOperands(query, startEndIndexes) {\n    let operands = [];\n    const startSplitIndex = startEndIndexes[0];\n    const endSplitIndex = startEndIndexes[1];\n\n    if (startSplitIndex !== 0) {\n      operands.push(query.substring(0, startSplitIndex).trim());\n    }\n    operands.push(query.substring(endSplitIndex + 1).trim());\n\n    operands = operands.map((operand) => {\n      let newOperand = operand;\n      if (operand[0] === '(') {\n        newOperand = newOperand.substring(1);\n      }\n      if (operand[operand.length - 1] === ')') {\n        newOperand = newOperand.substring(0, operand.length - 1);\n      }\n      return newOperand;\n    });\n\n    return operands;\n  }\n\n  /**\n   * Turns simple query expression into Mapea filter.\n   * @public\n   * @function\n   * @param {String} operator - operator to apply on split query\n   * @param { Array < String > } pieces - expression operands\n   * @api\n   */\n  translateOrderToQuery(operator, pieces) {\n    let mFilter = '';\n\n    switch (operator) {\n      case '=':\n        mFilter = M.filter.EQUAL(...pieces);\n        break;\n      case '<>':\n        const attr = pieces[0];\n        const val = pieces[1];\n        mFilter = new M.filter.Function((feature) => {\n          return feature.getAttribute(attr) !== val;\n        });\n        break;\n      case '<':\n        mFilter = M.filter.LT(...pieces);\n        break;\n      case '>':\n        mFilter = M.filter.GT(...pieces);\n        break;\n      case '<=':\n        mFilter = M.filter.LTE(...pieces);\n        break;\n      case '>=':\n        mFilter = M.filter.GTE(...pieces);\n        break;\n      case 'and':\n        mFilter = M.filter.AND([...pieces]);\n        break;\n      case 'or':\n        mFilter = M.filter.OR([...pieces]);\n        break;\n      case 'like':\n        mFilter = M.filter.LIKE(...pieces);\n        break;\n      case 'not':\n        mFilter = M.filter.NOT(...pieces);\n        break;\n      default:\n    }\n\n    return mFilter;\n  }\n\n  /**\n   * Finds the closing parentheses of a pair.\n   * @public\n   * @function\n   * @api\n   * @param {String} query - query string where the parentheses set is found\n   * @param { Number } openingIndex - opening parentheses index\n   */\n  findClosingParentheses(query, openingIndex) {\n    let closingParenthesesIndex;\n    let parenthesesCounter = 0;\n    for (let i = openingIndex + 1; i < query.length; i += 1) {\n      if (parenthesesCounter === 0 && query.charAt(i) === ')') {\n        closingParenthesesIndex = i;\n        i = query.length;\n      } else if (query.charAt(i) === '(') {\n        parenthesesCounter += 1;\n      } else if (query.charAt(i) === ')' && parenthesesCounter !== 0) {\n        parenthesesCounter -= 1;\n      }\n    }\n    return closingParenthesesIndex;\n  }\n\n  /**\n   * Checks if given operator is part of a word or a real operator.\n   * Returns true if it's a real operator.\n   * @public\n   * @function\n   * @api\n   * @param {String} query - string in which the operator candidate is found\n   * @param { Array < String > } operatorIndexes - start and end operator indexes on query\n   */\n  operatorInWord(query, operatorIndexes) {\n    let inWord = false;\n    const startSplitIndex = operatorIndexes[0];\n    const endSplitIndex = operatorIndexes[1];\n    const previousChar = query[startSplitIndex - 1];\n    const nextChar = query[endSplitIndex + 1];\n\n    if (((previousChar !== undefined) && (previousChar.match(/[a-z]/i))) ||\n      ((nextChar !== undefined) && (nextChar.match(/[a-z]/i)))) {\n      inWord = true;\n    }\n\n    return inWord;\n  }\n\n  /**\n   * Checks if a parentheses in a string belongs to a Mapea filter method.\n   * @public\n   * @function\n   * @param { String } query - complete or partial query string\n   * @param {Number} index - indexOf first parentheses on string\n   * @api\n   */\n  isMapeaFilterParentheses(query, index) {\n    const twoLettersOperators = ['OR', 'LT', 'GT'];\n    const threeLettersOperators = ['AND', 'NOT', 'LTE', 'GTE'];\n    const position = index;\n    let isMFilterPar = false;\n\n    if ((((position - 11 !== -1) && (query.substring(position - 11, position - 2) === 'M.filter.')) &&\n      twoLettersOperators.includes(query.substring(position - 2, position))) ||\n      (((position - 12 !== -1) && (query.substring(position - 12, position - 3) === 'M.filter.')) &&\n        threeLettersOperators.includes(query.substring(position - 3, position))) ||\n      (((position - 13 !== -1) && (query.substring(position - 13, position - 4) === 'M.filter.')) &&\n        (query.substring(position - 4, position) === 'LIKE')) ||\n      (((position - 14 !== -1) && (query.substring(position - 14, position - 5) === 'M.filter.')) &&\n        (query.substring(position - 5, position) === 'EQUAL'))) {\n      isMFilterPar = true;\n    }\n\n    return isMFilterPar;\n  }\n\n  /**\n   * Turns new given filter into a filter that combines the already applied filter and the new one.\n   * @public\n   * @function\n   * @param { M.Filter } mapeaFilter - new query filter\n   * @api\n   */\n  getMethodFilter(mapeaFilter) {\n    let combinedFilter;\n    switch (this.selectionMethod) {\n      case '1':\n        combinedFilter = mapeaFilter;\n        break;\n      case '2':\n        if (this.oldFilter !== undefined) {\n          // AND nueva query\n          combinedFilter = M.filter.AND([this.oldFilter, mapeaFilter]);\n        } else {\n          M.dialog.error(getValue('no_previous_query'));\n        }\n        break;\n      case '3':\n        if (this.oldFilter !== undefined) {\n          // AND NOT nueva query\n          combinedFilter = M.filter.AND([this.oldFilter, M.filter.NOT(mapeaFilter)]);\n        } else {\n          M.dialog.error(getValue('no_previous_query'));\n        }\n        break;\n      case '4':\n        if (this.oldFilter !== undefined) {\n          // OR nueva query\n          combinedFilter = M.filter.OR([this.oldFilter, mapeaFilter]);\n        } else {\n          M.dialog.error(getValue('no_previous_query'));\n        }\n        break;\n      default:\n        M.dialog.error(getValue('must_select_method'));\n        break;\n    }\n\n    return combinedFilter;\n  }\n\n  /**\n   * Performs button action onClick.\n   * @public\n   * @function\n   * @param {Event} e - triggering event\n   * @api\n   */\n  processQuery(e) {\n    const optsContainer = document.querySelector('#m-filteredsearch-options-container');\n    const btnContainer = document.querySelector('#m-filteredsearch-options-buttons');\n    const action = e.target.getAttribute('id');\n\n    switch (action) {\n      case 'aceptar-btn':\n        if (this.layer_ === undefined) {\n          M.dialog.error(getValue('must_select_layer'));\n        } else {\n          if (this.selectionMethod === '1') {\n            this.oldFilter = undefined;\n            this.oldLayer = undefined;\n          }\n          this.setNewFilter();\n          if (this.isValidQuery && this.selectionMethod !== undefined) this.setOkButtons();\n        }\n        break;\n      case 'limpiar-busqueda-btn':\n        this.cleanSearch();\n        break;\n      case 'limpiar-filtro-btn':\n        this.layer_.removeFilter();\n        this.setInitialButtons(btnContainer);\n        break;\n      case 'vertabla-btn':\n        this.saveResultsOnTable();\n        optsContainer.innerHTML = '';\n        optsContainer.appendChild(this.filterResults);\n        this.setTableViewButtons(btnContainer);\n        break;\n      case 'exportar-btn':\n        this.exportResults();\n        break;\n      case 'guardar-btn':\n        if (this.isValidQuery) {\n          this.myqueries.push({\n            query: this.sqlQuery,\n            layer: this.layer_,\n          });\n        } else {\n          M.dialog.error(getValue('invalid_query'));\n        }\n        break;\n      case 'misconsultas-btn':\n        this.myQueriesClick(optsContainer);\n        this.showMyQueriesViewButtons(btnContainer);\n        break;\n      case 'volver-btn':\n        optsContainer.innerHTML = '';\n        optsContainer.appendChild(this.initialView);\n        this.setOkButtons();\n        if (this.clickedQuery !== undefined) {\n          document.getElementById('m-filteredsearch-textArea').value = this.clickedQuery.query;\n          const Select = document.getElementById('m-filteredsearch-layers-select');\n          // eslint-disable-next-line no-plusplus\n          for (let i = 0; i < Select.options.length; i++) {\n            if (Select.options[i].value === this.clickedQuery.layer.name) {\n              Select.options.selectedIndex = [i];\n            }\n          }\n          this.clickedQuery = undefined;\n        }\n        // TODO: check if there's a filter applied to show data btns or not\n        document.querySelector('#guardar-btn').style.display = 'none';\n        break;\n      case 'eliminar-btn':\n        // this.deleteFromButton();\n        break;\n      default:\n        break;\n    }\n  }\n\n  /**\n   * Shows saved queries view (saved queries with filter activation on click).\n   * @public\n   * @function\n   * @api\n   * @param {HTML Element} central panel\n   */\n  myQueriesClick(container) {\n    const optsContainer = container;\n    optsContainer.innerHTML = '';\n\n    this.compileMyQueriesTemplate();\n\n    this.addSavedQueryClick();\n\n    optsContainer.appendChild(this.savedQueriesView);\n  }\n\n  /**\n   * Adds event listener for click on saved query table cell.\n   * @public\n   * @function\n   * @api\n   */\n  addSavedQueryClick() {\n    this.savedQueriesView.querySelectorAll('td').forEach((td, idx) => {\n      td.addEventListener('click', (e) => {\n        this.savedQueryClicked(e, td, idx);\n      });\n    });\n  }\n\n  /**\n   * Deletes previous filters and applies clicked filter to map.\n   * Adds focus to clicked query cell.\n   * Shows delete query button.\n   * @param {Event} e - triggering event\n   * @param {HTML Element} td - clicked query table cell\n   * @param {Number} idx - this.myqueries clicked query index\n   */\n  savedQueryClicked(e, td, idx) {\n    this.deleteAppliedFilters();\n    this.clickedQuery = this.myqueries[idx];\n    this.mapeaFilterQuery = this.turnStringIntoQuery(this.clickedQuery.query);\n    this.layer_ = this.clickedQuery.layer;\n    this.layer_.setFilter(this.mapeaFilterQuery);\n\n    Array.prototype.forEach.call(\n      e.target.parentNode.parentNode.parentNode.children[0].children,\n      (row) => {\n        Array.prototype.forEach.call(row.children, (rowCell) => {\n          rowCell.classList.remove('focus');\n        });\n      },\n    );\n    e.target.classList.add('focus');\n\n    const deleteBtn = document.querySelector('#m-filteredsearch-options-buttons').querySelector('#eliminar-btn');\n    deleteBtn.style.display = 'inline';\n    deleteBtn.onclick = () => {\n      this.deleteSavedQuery(td, idx);\n      this.compileMyQueriesTemplate();\n      this.addSavedQueryClick();\n      document.querySelector('#m-filteredsearch-options-container').appendChild(this.savedQueriesView);\n    };\n  }\n\n  /**\n   * Deletes saved query from this.myqueries.\n   * @public\n   * @function\n   * @param {HTML Element} td - results table cell with query\n   * @param {Number} idx - saved queries array query index\n   * @api\n   */\n  deleteSavedQuery(td, idx) {\n    this.myqueries.splice(idx, 1);\n    td.parentNode.remove();\n    document.querySelector('#m-filteredsearch-options-buttons').querySelector('#eliminar-btn').style.display = 'none';\n    this.sqlQuery = '';\n    this.layer_.removeFilter();\n    if (this.myqueries.length === 0) {\n      document.querySelector('#m-filteredsearch-options-container').innerHTML = getValue('no_saved_queries');\n    }\n  }\n\n  /**\n   * Compiles savedQueries template with this.myqueries data.\n   * @public\n   * @function\n   * @api\n   */\n  compileMyQueriesTemplate() {\n    if (this.savedQueriesView !== undefined) {\n      let child = this.savedQueriesView.lastElementChild;\n      while (child) {\n        child.remove();\n        child = this.savedQueriesView.lastElementChild;\n      }\n    }\n\n    this.mySqlQueries = this.myqueries.map((q) => {\n      const newQuery = q;\n      newQuery.query = q.query.replace(/\\.\\*/g, '%').replace(/\\./g, '_');\n      return newQuery;\n    });\n    this.savedQueriesView = M.template.compileSync(savedQueries, {\n      vars: {\n        queries: this.mySqlQueries,\n        translations: {\n          no_saved_queries: getValue('no_saved_queries'),\n        },\n      },\n    });\n  }\n\n  /**\n   * Resets every layer to initial filter (null).\n   * @public\n   * @function\n   * @api\n   */\n  deleteAppliedFilters() {\n    const vectorLayers = this.map.getWFS()\n      .concat(this.map.getKML()\n        .concat(this.map.getLayers().filter((layer) => {\n          return layer.type === 'GeoJSON';\n        })));\n    vectorLayers.forEach((layer) => {\n      if (layer.getFilter !== null) layer.removeFilter();\n    });\n  }\n\n  /**\n   * Sets new filter on layer.\n   * @public\n   * @function\n   * @api\n   */\n  setNewFilter() {\n    // Sets new filter\n    if (this.sqlQuery === '') {\n      M.dialog.error(getValue('must_query'));\n      // Resets last saved query\n      this.mapeaFilterQuery = this.oldFilter;\n      this.layer_ = this.oldLayer;\n    } else if (this.oldLayer !== undefined && this.oldLayer !== this.layer_) {\n      M.dialog.error(getValue('cant_apply'));\n      // Resets last saved query\n      this.mapeaFilterQuery = this.oldFilter;\n      this.layer_ = this.oldLayer;\n    } else {\n      // Gets new query\n      let tryFilter;\n\n      // FIXME: Trying to do nothing if filter doesn't get set on map\n      // Cases visibility and description of 'Arboleda' layer never enter catch. Doesn't work right.\n      try {\n        tryFilter = this.turnStringIntoQuery(this.sqlQuery);\n        tryFilter = this.getMethodFilter(tryFilter);\n        this.layer_.setFilter(tryFilter);\n        if (this.layer_.getFilter() !== null) {\n          this.mapeaFilterQuery = tryFilter;\n          this.oldFilter = this.mapeaFilterQuery;\n          this.oldLayer = this.layer_;\n          this.isValidQuery = true;\n        } else {\n          this.isValidQuery = false;\n          throw new Error(getValue('invalid_filter'));\n        }\n      } catch (err) {\n        this.isValidQuery = false;\n        M.dialog.error(getValue('cant_apply_filter'));\n      }\n    }\n  }\n\n  /**\n   * Downloads .csv file with results data.\n   * @public\n   * @function\n   * @api\n   */\n  exportResults() {\n    const features = this.layer_.getFeatures();\n    if (features.length > 0) {\n      const csvString = this.dataToCsv(features);\n      this.downloadCsv(csvString);\n    } else {\n      M.dialog.error(getValue('no_export_data'));\n    }\n  }\n\n  /**\n   * Saves features attributes on csv string.\n   * @public\n   * @function\n   * @param {M.feature} features - query results features\n   * @api\n   */\n  dataToCsv(features) {\n    let csv = '';\n    const featureKeys = Object.keys(features[0].getAttributes());\n    featureKeys.forEach((key) => { csv += `${key},`; });\n    csv = `${csv.substring(0, csv.length - 1)}\\n`; // deletes last ',' and adds line break\n\n    features.forEach((feature) => {\n      const featureAttrs = feature.getAttributes(); // {cod: '11', nombre: 'Cádiz'}\n      featureKeys.forEach((key) => {\n        // only escape() if string has more than letters and spaces\n        // substitute 'escape' (deprecated) for own escape method\n        // csv += `${escape(featureAttrs[key])},`;\n        csv += featureAttrs[key];\n        csv += ',';\n      });\n      csv = `${csv.substring(0, csv.length - 1)}\\n`; // deletes last ',' and adds line break\n    });\n    csv = csv.substring(0, csv.length - 1); // deletes last line break\n    return csv;\n  }\n\n  /**\n   * Creates hidden link element and clicks it to download given csv data.\n   * @public\n   * @function\n   * @api\n   * @param {String} csvdata - csv data with query results\n   */\n  downloadCsv(csvdata) {\n    const fileName = 'queryresults.csv';\n    const fileUrl = `data:text/csv;charset=utf-8,${encodeURI(csvdata)}`;\n    const hiddenLink = document.createElement('a');\n    hiddenLink.href = fileUrl;\n    hiddenLink.download = fileName;\n    hiddenLink.click();\n  }\n\n  /**\n   * Shows initial view buttons.\n   * @public\n   * @function\n   * @param {HTML Element} panelContainer - Buttons div container\n   * @api\n   */\n  setInitialButtons(panelContainer) {\n    const btnContainer = panelContainer;\n    btnContainer.querySelector('#volver-btn').style.display = 'none';\n    btnContainer.querySelector('#aceptar-btn').style.display = 'inline';\n    btnContainer.querySelector('#limpiar-busqueda-btn').style.display = 'inline';\n    btnContainer.querySelector('#limpiar-filtro-btn').style.display = 'inline';\n    btnContainer.querySelector('#vertabla-btn').style.display = 'none';\n    btnContainer.querySelector('#exportar-btn').style.display = 'none';\n    btnContainer.querySelector('#guardar-btn').style.display = 'none';\n    btnContainer.querySelector('#misconsultas-btn').style.display = 'inline';\n    btnContainer.querySelector('#eliminar-btn').style.display = 'none';\n  }\n\n  /**\n   * Shows buttons for view after a filter is set.\n   * @public\n   * @function\n   * @api\n   */\n  setOkButtons() {\n    document.querySelector('#volver-btn').style.display = 'none';\n    document.querySelector('#aceptar-btn').style.display = 'inline';\n    document.querySelector('#limpiar-busqueda-btn').style.display = 'inline';\n    document.querySelector('#limpiar-filtro-btn').style.display = 'inline';\n    document.querySelector('#vertabla-btn').style.display = 'inline';\n    document.querySelector('#exportar-btn').style.display = 'inline';\n    document.querySelector('#guardar-btn').style.display = 'inline';\n    document.querySelector('#misconsultas-btn').style.display = 'inline';\n    document.querySelector('#eliminar-btn').style.display = 'none';\n  }\n\n  /**\n   * Hides some buttons for \"Results table\" view.\n   * @public\n   * @function\n   * @param {HTML Element} container - Buttons div container\n   * @api\n   */\n  setTableViewButtons(container) {\n    const btnContainer = container;\n    btnContainer.querySelector('#volver-btn').style.display = 'inline';\n    btnContainer.querySelector('#aceptar-btn').style.display = 'none';\n    btnContainer.querySelector('#limpiar-busqueda-btn').style.display = 'none';\n    btnContainer.querySelector('#limpiar-filtro-btn').style.display = 'none';\n    btnContainer.querySelector('#vertabla-btn').style.display = 'none';\n    btnContainer.querySelector('#exportar-btn').style.display = 'none';\n    btnContainer.querySelector('#guardar-btn').style.display = 'none';\n    btnContainer.querySelector('#misconsultas-btn').style.display = 'none';\n  }\n\n  /**\n   * Hides all unnecessary buttons for MyQueries view.\n   * @public\n   * @function\n   * @api\n   * @param {HTML Element} container - Buttons div container\n   */\n  showMyQueriesViewButtons(container) {\n    const btnContainer = container;\n    btnContainer.querySelector('#volver-btn').style.display = 'inline';\n    btnContainer.querySelector('#aceptar-btn').style.display = 'none';\n    btnContainer.querySelector('#limpiar-busqueda-btn').style.display = 'none';\n    btnContainer.querySelector('#limpiar-filtro-btn').style.display = 'none';\n    btnContainer.querySelector('#vertabla-btn').style.display = 'none';\n    btnContainer.querySelector('#exportar-btn').style.display = 'none';\n    btnContainer.querySelector('#guardar-btn').style.display = 'none';\n    btnContainer.querySelector('#misconsultas-btn').style.display = 'none';\n  }\n\n  /**\n   * Cleans input selections.\n   * @public\n   * @function\n   * @api\n   */\n  cleanSearch() {\n    document.querySelector('.filtered-search-panel').querySelector('textarea').value = '';\n    document.querySelector('#m-filteredsearch-method-select').value = getValue('select_method');\n    this.selectionMethod = '';\n    this.sqlQuery = '';\n    document.querySelector('#m-filteredsearch-layers-select').querySelector('#layers0').selected = true;\n    document.querySelector('#m-filteredsearch-fields').innerHTML = `<p class=\"m-filteredsearch-headers\">${getValue('fields')}</p>`;\n    document.querySelector('#m-filteredsearch-values').innerHTML = `<p class=\"m-filteredsearch-headers\">${getValue('values')}</p>`;\n  }\n\n  /**\n   * Shows expected results page\n   * @public\n   * @function\n   * @param {Array <Array>} pages - results divided in pages\n   * @api\n   */\n  showTableViewPage(pages) {\n    // empty results table\n    this.filterResults.querySelector('#queryresults').innerHTML = '';\n\n    // Get layer attributes and show column titles and pagination buttons\n    const attributes = this.layer_.getFeatures()[0].getAttributes();\n    let newLine = document.createElement('tr');\n    Object.keys(attributes).forEach((attributeKey) => {\n      const newTitleCell = document.createElement('th');\n      const cellText = document.createTextNode(attributeKey);\n      newTitleCell.appendChild(cellText);\n      newLine.appendChild(newTitleCell);\n    });\n    this.filterResults.querySelector('#queryresults').appendChild(newLine);\n    this.filterResults.querySelector('#paginationbuttons>#pageNumBtn').innerHTML = `${this.resultsPage + 1} de ${pages.length}`;\n\n    // Show every result on a new table row\n    const currentPageFeatures = pages[this.resultsPage];\n    currentPageFeatures.forEach((filteredFeature) => {\n      newLine = document.createElement('tr');\n      const filteredAttributes = filteredFeature.getAttributes();\n      Object.keys(filteredAttributes).forEach((key) => {\n        const newCell = document.createElement('td');\n        // Commented code in case table field needs to show table\n        // const htmlContent = document.createElement('div');\n        // htmlContent.innerHTML = filteredAttributes[key];\n        // newCell.appendChild(htmlContent);\n        const txt = document.createTextNode(filteredAttributes[key].toString());\n        newCell.appendChild(txt);\n        newLine.appendChild(newCell);\n      });\n      this.filterResults.querySelector('#queryresults').appendChild(newLine);\n    });\n  }\n\n  /**\n   * Creates a table row for every result after filtering layer features.\n   * @function\n   * @public\n   * @api\n   */\n  saveResultsOnTable() {\n    if (this.layer_.getFeatures().length > 0) {\n      // Divide filter results into pages & show current page\n      const pages = this.divideList(this.layer_.getFeatures());\n      this.showTableViewPage(pages);\n\n      // Page turning\n      this.filterResults.querySelectorAll('#paginationbuttons>button').forEach((btn) => {\n        btn.addEventListener('click', (e) => {\n          if (e.target.id === 'prevBtn') {\n            this.resultsPage = this.resultsPage > 0 ? this.resultsPage -= 1 : this.resultsPage;\n          } else {\n            this.resultsPage = this.resultsPage < pages.length - 1 ?\n              this.resultsPage += 1 : this.resultsPage;\n          }\n          this.showTableViewPage(pages);\n        });\n      });\n    } else {\n      this.filterResults.innerHTML = getValue('no_entities');\n    }\n  }\n\n  /**\n   * Saves clicked button operator in query and adds it to textarea.\n   * @public\n   * @function\n   * @param {Event} e\n   * @param {HTML Element} btn\n   * @api\n   */\n  operatorClick(e, btn) {\n    const txtarea = document.querySelector('.filtered-search-panel').querySelector('textarea');\n    switch (btn.innerHTML) {\n      case '()':\n        if (this.parenthesesClick === 0) {\n          txtarea.value += '(';\n          this.sqlQuery += '(';\n          this.parenthesesClick = 1;\n        } else {\n          txtarea.value += ')';\n          this.sqlQuery += ')';\n          this.parenthesesClick = 0;\n        }\n        break;\n      case '&#61;':\n        txtarea.value += ' = ';\n        this.sqlQuery += ' = ';\n        break;\n      case '&lt;':\n        txtarea.value += ' < ';\n        this.sqlQuery += ' < ';\n        break;\n      case '&gt;':\n        txtarea.value += ' > ';\n        this.sqlQuery += ' > ';\n        break;\n      case '&lt;&gt;':\n        txtarea.value += ' <> ';\n        this.sqlQuery += ' <> ';\n        break;\n      case '&gt;=':\n        txtarea.value += ' >= ';\n        this.sqlQuery += ' >= ';\n        break;\n      case '&lt;=':\n        txtarea.value += ' <= ';\n        this.sqlQuery += ' <= ';\n        break;\n      case '_': // sql _ -> regexp .\n        txtarea.value += '_';\n        this.sqlQuery += '.';\n        break;\n      case '%': // sql % -> regexp .*\n        txtarea.value += '%';\n        this.sqlQuery += '.*';\n        break;\n      default:\n        txtarea.value += ` ${btn.innerHTML.toLowerCase()} `;\n        this.sqlQuery += ` ${btn.innerHTML.toLowerCase()} `;\n    }\n  }\n\n  /**\n   * Shows selected layer fields list first page (if layer is loaded).\n   * @public\n   * @function\n   * @param { String } layerName - selected layer name\n   * @api\n   */\n  showLayerFields(layerName) {\n    // finds and saves param layerName\n    if (!M.utils.isNullOrEmpty(layerName)) {\n      this.layer_ = this.hasLayer_(layerName)[0];\n    }\n\n    if (this.isLayerLoaded(this.layer_)) {\n      this.fieldValues = [];\n      const features = this.layer_.getFeatures();\n\n      // clears previous query\n      this.oldFilter = this.mapeaFilterQuery;\n      this.oldLayer = this.layer_;\n      document.querySelector('.filtered-search-panel').querySelector('textarea').value = '';\n      this.sqlQuery = '';\n      this.mapeaFilterQuery = null;\n\n      // if there's features on this.layer_, save them and their values on arrays\n      if (!M.utils.isNullOrEmpty(features)) {\n        this.fields = Object.keys(features[0].getAttributes());\n        features.forEach((feature) => {\n          const properties = Object.values(feature.getAttributes());\n          if (!M.utils.isNullOrEmpty(properties)) {\n            this.fieldValues.push(properties);\n          }\n        });\n\n        this.fieldsPages = this.divideList(this.fields);\n        const fields = this.fieldsPages[0];\n\n        const options = { jsonp: true, vars: { fields } };\n        this.fieldsTemplate = M.template.compileSync(fieldsTemplate, options);\n        this.fieldsTemplate.querySelector('#pageNumBtn').innerHTML = `1 de ${this.fieldsPages.length}`;\n        document.querySelector('#m-filteredsearch-fields').innerHTML = `<p class=\"m-filteredsearch-headers\">${getValue('fields')}</p>`;\n        document.querySelector('#m-filteredsearch-fields').appendChild(this.fieldsTemplate);\n\n        this.showFields();\n        this.addpageBtnEvt();\n      }\n    } else {\n      M.dialog.error(getValue('layer_load'));\n    }\n  }\n\n  /**\n   * Checks if layer is loaded.\n   * @public\n   * @function\n   * @param {Mapea Layer} layer - clicked layer on select menu\n   * @api\n   */\n  isLayerLoaded(layer) {\n    let isLoaded = false;\n    const kmlLayerLoaded = this.kmlLayers.find(l => l.layer === layer) ?\n      this.kmlLayers.find(l => l.layer === layer).loaded : false;\n    if (layer.type && layer.type !== 'KML' && layer.getImpl().isLoaded()) {\n      isLoaded = true;\n    } else if (kmlLayerLoaded) {\n      isLoaded = true;\n    }\n    return isLoaded;\n  }\n\n  /**\n   * Adds click event on each field.\n   * Adds field name to query, finds possible field values and shows them and changes cell focus.\n   * @public\n   * @function\n   * @api\n   */\n  showFields() {\n    document.querySelector('#m-filteredsearch-fields').querySelectorAll('td').forEach((cell) => {\n      const values = [];\n      const fieldIndex = this.fields.indexOf(cell.innerHTML);\n      this.fieldValues.forEach((element) => {\n        values.push(element[fieldIndex]);\n      });\n      cell.addEventListener('click', (e) => {\n        const txtarea = document.querySelector('.filtered-search-panel').querySelector('textarea');\n        txtarea.value += e.target.innerHTML;\n        this.sqlQuery += e.target.innerHTML;\n        this.selectField(values);\n        // sets 'focus'\n        Array.prototype.forEach.call(\n          e.target.parentNode.parentNode.parentNode.children[0].children,\n          (row) => {\n            Array.prototype.forEach.call(row.children, (rowCell) => {\n              rowCell.classList.remove('focus');\n            });\n          },\n        );\n        e.target.classList.add('focus');\n      });\n    });\n  }\n\n  /**\n   * Adds pagination buttons onclick events.\n   * @public\n   * @function\n   * @api\n   */\n  addpageBtnEvt() {\n    this.fieldsTemplate.querySelectorAll('#m-attributetable-tfoot>button').forEach((element) => {\n      element.addEventListener('click', e => this.changePage(e, 'fields', this.fieldsPages.length));\n    });\n    this.valuesTemplate.querySelectorAll('#m-attributetable-tfoot>button').forEach((element) => {\n      element.addEventListener('click', e => this.changePage(e, 'values', this.valuesPages.length));\n    });\n  }\n\n  /**\n   * Divides list items in groups of 5 items.\n   * @public\n   * @function\n   * @api\n   * @param {List} items - items (fields/values) to separate in pages\n   * @returns {Array <Array>} pages - each inside array has n items\n   */\n  divideList(items) {\n    const numberOfItemsPerPage = 5;\n    const pages = [];\n    let firstItem = 0;\n    while (firstItem < items.length) {\n      const newPage = [];\n      for (let i = firstItem; i < firstItem + numberOfItemsPerPage; i += 1) {\n        newPage.push(items[i]);\n        if (i + 1 === items.length) {\n          i = firstItem + numberOfItemsPerPage;\n        }\n      }\n      pages.push(newPage);\n      firstItem += numberOfItemsPerPage;\n    }\n    return pages;\n  }\n\n  /**\n   * Changes currentPage number and shows page results on fields/values list.\n   * @public\n   * @function\n   * @api\n   * @param {Event} e - event triggering button\n   * @param {String} fieldsOrValues - container key (either 'fields' or 'values')\n   * @param {Number} numberOfPages\n   */\n  changePage(e, fieldsOrValues, numberOfPages) {\n    let currentPage = fieldsOrValues === 'fields' ? this.currentFieldsPage : this.currentValuesPage;\n\n    if (e.target.id === 'prevBtn') {\n      currentPage = currentPage > 0 ? currentPage -= 1 : currentPage;\n    } else {\n      currentPage = currentPage < numberOfPages - 1 ? currentPage += 1 : currentPage;\n    }\n\n    if (fieldsOrValues === 'fields') {\n      this.currentFieldsPage = currentPage;\n    } else {\n      this.currentValuesPage = currentPage;\n    }\n\n    this.showPageResults(fieldsOrValues);\n    this.addpageBtnEvt();\n  }\n\n  /**\n   * Shows current page results on fields/values area.\n   * @public\n   * @function\n   * @api\n   * @param {HTML Element} fieldsOrValues - element where items will be shown\n   */\n  showPageResults(fieldsOrValues) {\n    if (fieldsOrValues === 'fields') {\n      const fields = this.fieldsPages[this.currentFieldsPage];\n      const options = { jsonp: true, vars: { fields } };\n      this.fieldsTemplate = M.template.compileSync(fieldsTemplate, options);\n      this.fieldsTemplate.querySelector('#pageNumBtn').innerHTML = `${this.currentFieldsPage + 1} de ${this.fieldsPages.length}`;\n      document.querySelector('#m-filteredsearch-fields').innerHTML = `<p class=\"m-filteredsearch-headers\">${getValue('fields')}</p>`;\n      document.querySelector('#m-filteredsearch-fields').appendChild(this.fieldsTemplate);\n      this.showFields();\n    } else {\n      const values = this.valuesPages[this.currentValuesPage];\n      const options = { jsonp: true, vars: { values } };\n      this.valuesTemplate = M.template.compileSync(valuesTemplate, options);\n      this.valuesTemplate.querySelector('#pageNumBtn').innerHTML = `${this.currentValuesPage + 1} de ${this.valuesPages.length}`;\n      this.fieldsTemplate.querySelector('#pageNumBtn').innerHTML = `${this.currentFieldsPage + 1} de ${this.fieldsPages.length}`;\n      document.querySelector('#m-filteredsearch-values').innerHTML = `<p class=\"m-filteredsearch-headers\">${getValue('values')}</p>`;\n      document.querySelector('#m-filteredsearch-values').appendChild(this.valuesTemplate);\n      document.querySelector('#m-filteredsearch-values').querySelectorAll('td').forEach((cell) => {\n        cell.addEventListener('click', (e) => {\n          const txtarea = document.querySelector('.filtered-search-panel').querySelector('textarea');\n          txtarea.value += e.target.innerHTML;\n          this.sqlQuery += e.target.innerHTML;\n          Array.prototype.forEach.call(\n            e.target.parentNode.parentNode.parentNode.children[0].children,\n            (row) => {\n              Array.prototype.forEach.call(row.children, (rowCell) => {\n                rowCell.classList.remove('focus');\n              });\n            },\n          );\n          e.target.classList.add('focus');\n        });\n      });\n    }\n  }\n\n  /**\n   * Shows possible values for selected field.\n   * @public\n   * @function\n   * @param {Array} values - existing values for selected field\n   * @api\n   */\n  selectField(fieldValues) {\n    // reduces field values to unique possible values\n    const values = fieldValues.filter((value, index, self) => {\n      return self.indexOf(value) === index;\n    });\n\n    this.valuesPages = this.divideList(values);\n    const firstValues = this.valuesPages[0];\n    const options = { jsonp: true, vars: { values: firstValues } };\n\n    this.currentFieldsPage = 0;\n    this.currentValuesPage = 0;\n\n    this.valuesTemplate = M.template.compileSync(valuesTemplate, options);\n    this.valuesTemplate.querySelector('#pageNumBtn').innerHTML = `${this.currentValuesPage + 1} de ${this.valuesPages.length}`;\n\n    this.valuesTemplate.querySelectorAll('#m-filteredsearch-valuestable>tbody>tr>td').forEach((tableCell) => {\n      tableCell.addEventListener('click', e => this.selectValue(e));\n    });\n    document.querySelector('#m-filteredsearch-values').innerHTML = `<p class='m-filteredsearch-headers'>${getValue('values')}</p>`;\n    document.querySelector('#m-filteredsearch-values').appendChild(this.valuesTemplate);\n    this.addpageBtnEvt();\n  }\n\n  /**\n   * Adds clicked option info to textarea and query.\n   * @public\n   * @function\n   * @param {Event} e - triggering event\n   * @api\n   */\n  selectValue(e) {\n    const txtarea = document.querySelector('.filtered-search-panel').querySelector('textarea');\n    txtarea.value += e.currentTarget.innerHTML;\n    this.sqlQuery += e.currentTarget.innerHTML;\n    Array.prototype.forEach.call(\n      e.currentTarget.parentNode.parentNode.children,\n      (row) => {\n        row.children[0].classList.remove('focus');\n      },\n    );\n    e.currentTarget.classList.add('focus');\n  }\n\n  /**\n   * Checks if map has given layer and returns that layer.\n   *\n   * @private\n   * @param {array<string>| string| M.Layer} layerSearch -\n        Array of layer names, layer name or layer instance\n   * @function\n   */\n  hasLayer_(layerSearch) {\n    const layersFind = [];\n    if (M.utils.isNullOrEmpty(layerSearch) || (!M.utils.isArray(layerSearch) &&\n      !M.utils.isString(layerSearch) && !(layerSearch instanceof M.Layer))) {\n      M.dialog.error(getValue('hasLayer_error'), getValue('error'));\n      return layersFind;\n    }\n\n    if (M.utils.isString(layerSearch)) {\n      this.map.getLayers().forEach((lay) => {\n        if (lay.name === layerSearch) {\n          layersFind.push(lay);\n        }\n      });\n    }\n\n    if (layerSearch instanceof M.Layer) {\n      this.map.getLayers().forEach((lay) => {\n        if (lay.equals(layerSearch)) {\n          layersFind.push(lay);\n        }\n      });\n    }\n    if (M.utils.isArray(layerSearch)) {\n      this.map.getLayers().forEach((lay) => {\n        if (layerSearch.indexOf(lay.name) >= 0) {\n          layersFind.push(lay);\n        }\n      });\n    }\n    return layersFind;\n  }\n\n  /**\n   * This function compares controls\n   *\n   * @public\n   * @function\n   * @param {M.Control} control to compare\n   * @api stable\n   */\n  equals(control) {\n    return control instanceof FilteredSearchControl;\n  }\n}\n","/**\n * @module M/plugin/FilteredSearch\n */\nimport 'assets/css/filteredsearch';\nimport 'assets/css/fonts';\nimport FilteredSearchControl from './filteredsearchcontrol';\nimport api from '../../api';\nimport { getValue } from './i18n/language';\n\nexport default class FilteredSearch extends M.Plugin {\n  /**\n   * @classdesc\n   * Main facade plugin object. This class creates a plugin\n   * object which has an implementation Object\n   *\n   * @constructor\n   * @extends {M.Plugin}\n   * @param {Object} impl implementation object\n   * @api stable\n   */\n  constructor(options = {}) {\n    super();\n    /**\n     * Facade of the map\n     * @private\n     * @type {M.Map}\n     */\n    this.map_ = null;\n\n    /**\n     * Array of controls\n     * @private\n     * @type {Array<M.Control>}\n     */\n    this.controls_ = [];\n\n    /**\n     * Position of the plugin on browser window\n     * @private\n     * @type {Enum}\n     * Possible values: 'TL', 'TR', 'BR', 'BL'\n     */\n    this.position_ = options.position || 'TR';\n\n    /**\n     * Metadata from api.json\n     * @private\n     * @type {Object}\n     */\n    this.metadata_ = api.metadata;\n  }\n\n  /**\n   * This function adds this plugin into the map\n   *\n   * @public\n   * @function\n   * @param {M.Map} map the map to add the plugin\n   * @api stable\n   */\n  addTo(map) {\n    const pluginOnLeft = !!(['TL', 'BL'].includes(this.position_));\n\n    const values = {\n      pluginOnLeft,\n    };\n\n    this.control_ = new FilteredSearchControl(values);\n    this.controls_.push(this.control_);\n    this.map_ = map;\n\n    // Dependiendo de dónde se muestre el plugin, mostrará una flecha u otra.\n    const collapsedButton = 'g-plugin-filteredsearch-filter';\n\n    // panel para agregar control - no obligatorio\n    this.panel_ = new M.ui.Panel('panelFilteredSearch', {\n      className: 'filtered-search-panel',\n      collapsible: true,\n      position: M.ui.position[this.position_],\n      collapsedButtonClass: collapsedButton,\n      tooltip: getValue('tooltip'),\n    });\n    this.panel_.addControls(this.controls_);\n    map.addPanels(this.panel_);\n  }\n\n  /**\n   * Destroys plugin\n   * @public\n   * @function\n   * @api\n   */\n  destroy() {\n    this.map_.removeControls(this.controls_);\n    [this.map_, this.control_, this.controls_, this.panel_] = [null, null, null, null];\n  }\n\n  /**\n   * This function gets metadata plugin\n   *\n   * @public\n   * @function\n   * @api stable\n   */\n  getMetadata() {\n    return this.metadata_;\n  }\n\n  /**\n   * @getter\n   * @public\n   */\n  get name() {\n    return 'filteredsearch';\n  }\n}\n","import M$plugin$FilteredSearch from './/facade/js/filteredsearch';\nimport M$control$FilteredSearchControl from './/facade/js/filteredsearchcontrol';\nimport M$impl$control$FilteredSearchControl from './/impl/ol/js/filteredsearchcontrol';\n\nif (!window.M.plugin) window.M.plugin = {};\nif (!window.M.control) window.M.control = {};\nif (!window.M.impl) window.M.impl = {};\nif (!window.M.impl.control) window.M.impl.control = {};\nwindow.M.plugin.FilteredSearch = M$plugin$FilteredSearch;\nwindow.M.control.FilteredSearchControl = M$control$FilteredSearchControl;\nwindow.M.impl.control.FilteredSearchControl = M$impl$control$FilteredSearchControl;\n"],"sourceRoot":""}